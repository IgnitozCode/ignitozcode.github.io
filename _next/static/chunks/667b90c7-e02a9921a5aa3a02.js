"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[541],{54960:(e,t,n)=>{n.d(t,{A5:()=>nd,A6:()=>H,Ec:()=>Y,OL:()=>e8,OZ:()=>F,Og:()=>ng,Un:()=>n_,Wx:()=>U,XI:()=>q,fL:()=>R,hG:()=>nx,oH:()=>Z,pq:()=>np,tq:()=>et,tv:()=>X,v$:()=>er,xA:()=>I,xJ:()=>Q,xt:()=>M,zz:()=>nv});var i=n(45054),r=n(12115),o=n(84880),a=n(95155),s=n(52250),l=n(69579),c=n(25875),d=n(69663),h=n(47289),p=n(33720),u=n(8691),f=n(97752),y=n(41436),g=n(79585),m=n(90372),k=n(52634),b=n(28499),v=n(20209),x=n(49293),_=n(61611),E=n(69529),w=n(8883),B=n(96961),T=n(63168),S=n(50920),A=n(88148),N=n(97848),P=n(33252),O=n(39302),C=n(31561),z=n(84622),$=n(18475),j=n(66677);function D(e){if(!e)throw Error("Parameter 'portabletextType' missing (required)");let t=e.of?.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!t)throw Error("Block type is not defined in this schema (required)");let n=t.fields?.find(e=>"children"===e.name);if(!n)throw Error("Children field for block type found in schema (required)");let i=n.type.of;if(!i)throw Error("Valid types for block children not found in schema (required)");let r=i.find(e=>"span"===e.name);if(!r)throw Error("Span type not found in schema (required)");let o=i.filter(e=>"span"!==e.name)||[],a=e.of?.filter(e=>e.name!==t.name)||[];return{styles:function(e){let t=e.fields?.find(e=>"style"===e.name);if(!t)throw Error("A field with name 'style' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list?.filter(e=>e.value);if(!n||0===n.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return n}(t),decorators:r.decorators,lists:function(e){let t=e.fields?.find(e=>"listItem"===e.name);if(!t)throw Error("A field with name 'listItem' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list.filter(e=>e.value);if(!n)throw Error("The list field need at least to be an empty array");return n}(t),block:t,span:r,portableText:e,inlineObjects:o,blockObjects:a,annotations:r.annotations}}let K="sanity-pte:";function M(e){let t=`${K}${e}`;return c&&c.enabled(t)?c(t):c(K)}function G(e,t,n){let i;let r=[e.path[0]];if(!t)return null;let o=t[r[0]];if(!o)return null;let a=[{_key:o._key}];if(o._type!==n.block.name)return a;let s=e.path.slice(0,2),l=Array.isArray(o.children)&&o.children[s[1]];return l&&(i=["children",{_key:l._key}]),i?[...a,...i]:a}function L(e,t){if(!t)return[];let[n,i]=Array.from(d.KE.nodes(t,{at:[],match:t=>(0,m.tA)(e[0])&&t._key===e[0]._key}))[0]||[void 0,void 0];if(!n||!d.Hg.isElement(n))return[];if(t.isVoid(n))return[i[0],0];let r=[e[2]],o=n.children.findIndex(e=>y([{_key:e._key}],r));if(o>=0&&n.children[o]){let e=n.children[o];return d.Hg.isElement(e)&&t.isVoid(e)?i.concat(o).concat(0):i.concat(o)}return[i[0],0]}function I(e,t,n){if(!t)return null;let i=null,r=null,o=t.anchor&&G(t.anchor,e,n);o&&t.anchor&&(i={path:o,offset:t.anchor.offset});let a=t.focus&&G(t.focus,e,n);a&&t.focus&&(r={path:a,offset:t.focus.offset});let s=!!(d.Q6.isRange(t)&&d.Q6.isBackward(t));return i&&r?{anchor:i,focus:r,backward:s}:null}function U(e,t){if(!e||!t)return null;let n={path:L(e.anchor.path,t),offset:e.anchor.offset},i={path:L(e.focus.path,t),offset:e.focus.offset};return 0===i.path.length||0===n.path.length?null:i?{anchor:n,focus:i}:null}function R(e,t){let n=d.bR.transform(e.anchor,t),i=d.bR.transform(e.focus,t);return null===n||null===i?null:d.bR.equals(n,e.anchor)&&d.bR.equals(i,e.focus)?e:{anchor:n,focus:i}}c(K);let V="void-child";function J(e,t){let n=t[e._key];return n&&y(e,n)?n:(t[e._key]=e,e)}function Y(e,{schemaTypes:t},n={}){return e&&Array.isArray(e)?e.map(e=>{let{_type:i,_key:r,...o}=e,a=[{_key:V,_type:"span",text:"",marks:[]}];if(e&&e._type===t.block.name){let s=!1,l=typeof e.style>"u",c=typeof e.markDefs>"u",h=typeof e.children>"u",p=(e.children||[]).map(e=>{let{_type:t,_key:i,...r}=e;return"span"!==t?(s=!0,J({_type:t,_key:i,children:a,value:r,__inline:!0},n)):e});return!(!l&&!c&&!h&&!s&&d.Hg.isElement(e))?(l&&(o.style=t.styles[0].value),J({_type:i,_key:r,...o,children:p},n)):e}return J({_type:i,_key:r,children:a,value:o},n)}):[]}function q(e,t,n={}){return e.map(e=>{let{_key:i,_type:r}=e;if(!i||!r)throw Error("Not a valid block");if(r===t&&"children"in e&&Array.isArray(e.children)&&i){let t=!1,o=e.children.map(e=>{let{_type:i}=e;if("value"in e&&"span"!==i){t=!0;let{value:i,_key:r,_type:o,__inline:a,children:s,...l}=e;return J({...l,...i,_key:r,_type:o},n)}return e});return t?J({...e,children:o,_key:i,_type:r},n):e}let o="value"in e&&e.value;return J({_key:i,_type:r,..."object"==typeof o?o:{}},n)})}function H(e,t){return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&d.Hg.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&d.EY.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!e[0].children[0].marks?.join("")&&""===e[0].children[0].text}let W=new WeakMap,Q=new WeakMap,F=new WeakMap,Z=new WeakMap,X=new WeakMap,ee=new WeakMap,et=new WeakMap,en=new WeakMap,ei=(0,r.createContext)(null),er=()=>{let e=(0,r.useContext)(ei);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e};function eo(e){return T.S.compile({name:"blockTypeSchema",types:[e]}).get(e.name)}let ea=(0,h.mj)({types:{context:{},events:{},input:{},emitted:{}},actions:{"emit has pending patches":(0,p.e)({type:"has pending patches"}),"emit mutation":(0,p.e)(({context:e})=>({type:"mutation",patches:e.pendingPatches,snapshot:q(e.slateEditor.children,e.schema.block.name,et.get(e.slateEditor))})),"clear pending patches":(0,p.a)({pendingPatches:[]}),"defer patch":(0,p.a)({pendingPatches:({context:e,event:t})=>[...e.pendingPatches,t.patch]})},guards:{"slate is normalizing":({context:e})=>d.KE.isNormalizing(e.slateEditor)}}).createMachine({id:"mutation",context:({input:e})=>({pendingPatches:[],schema:e.schema,slateEditor:e.slateEditor}),initial:"idle",states:{idle:{on:{patch:{actions:["defer patch","emit has pending patches"],target:"has pending patches"}}},"has pending patches":{after:{1e3:[{guard:"slate is normalizing",target:"idle",actions:["emit mutation","clear pending patches"]},{reenter:!0}]},on:{patch:{actions:["defer patch"],reenter:!0}}}}});function es(e,t,n){let i=null,r=!0,o=[t.span.name,...t.inlineObjects.map(e=>e.name)],a=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,s)=>{if(!b(e))return i={patches:[(0,g.wC)([s])],description:`Block must be an object, got ${String(e)}`,action:"Unset invalid item",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-object.description",action:"inputs.portable-text.invalid-value.not-an-object.action",values:{index:s}}},!0;if(!e._key||"string"!=typeof e._key)return i={patches:[(0,g.hZ)({...e,_key:n()},[s])],description:`Block at index ${s} is missing required _key.`,action:"Set the block with a random _key value",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-key.description",action:"inputs.portable-text.invalid-value.missing-key.action",values:{index:s}}},!0;if(!e._type||!a.includes(e._type)){if("block"===e._type){let n=t.block.name;return i={patches:[(0,g.hZ)({...e,_type:n},[{_key:e._key}])],description:`Block with _key '${e._key}' has invalid type name '${e._type}'. According to the schema, the block type name is '${n}'`,action:`Use type '${n}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.incorrect-block-type.description",action:"inputs.portable-text.invalid-value.incorrect-block-type.action",values:{key:e._key,expectedTypeName:n}}},!0}return i=!e._type&&(0,m.L4)({...e,_type:t.block.name})?{patches:[(0,g.hZ)({...e,_type:t.block.name},[{_key:e._key}])],description:`Block with _key '${e._key}' is missing a type name. According to the schema, the block type name is '${t.block.name}'`,action:`Use type '${t.block.name}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-block-type.description",action:"inputs.portable-text.invalid-value.missing-block-type.action",values:{key:e._key,expectedTypeName:t.block.name}}}:e._type?{patches:[(0,g.wC)([{_key:e._key}])],description:`Block with _key '${e._key}' has invalid _type '${e._type}'`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-type.description",action:"inputs.portable-text.invalid-value.disallowed-type.action",values:{key:e._key,typeName:e._type}}}:{patches:[(0,g.wC)([{_key:e._key}])],description:`Block with _key '${e._key}' is missing an _type property`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-type.description",action:"inputs.portable-text.invalid-value.missing-type.action",values:{key:e._key}}},!0}if(e._type===t.block.name){if(e.children&&!Array.isArray(e.children))return i={patches:[(0,g.hZ)({children:[]},[{_key:e._key}])],description:`Text block with _key '${e._key}' has a invalid required property 'children'.`,action:"Reset the children property",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-or-invalid-children.description",action:"inputs.portable-text.invalid-value.missing-or-invalid-children.action",values:{key:e._key}}},!0;if(void 0===e.children||Array.isArray(e.children)&&0===e.children.length){let r={_type:t.span.name,_key:n(),text:"",marks:[]};return i={autoResolve:!0,patches:[(0,g.Wm)([],[{_key:e._key},"children"]),(0,g.Yr)([r],"after",[{_key:e._key},"children",0])],description:`Children for text block with _key '${e._key}' is empty.`,action:"Insert an empty text",item:e,i18n:{description:"inputs.portable-text.invalid-value.empty-children.description",action:"inputs.portable-text.invalid-value.empty-children.action",values:{key:e._key}}},!0}let a=v(k(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[])));if(Array.isArray(e.markDefs)&&e.markDefs.length>0){let t=v(e.markDefs.map(e=>e._key).filter(e=>!a.includes(e)));if(t.length>0)return i={autoResolve:!0,patches:t.map(t=>(0,g.wC)([{_key:e._key},"markDefs",{_key:t}])),description:`Block contains orphaned data (unused mark definitions): ${t.join(", ")}.`,action:"Remove unused mark definition item",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-mark-defs.description",action:"inputs.portable-text.invalid-value.orphaned-mark-defs.action",values:{key:e._key,unusedMarkDefs:t.map(e=>e.toString())}}},!0}let s=a.filter(e=>!t.decorators.map(e=>e.value).includes(e)).filter(t=>void 0===e.markDefs||!e.markDefs.find(e=>e._key===t));if(s.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>s.includes(e)));if(n){let t=s.join(", ");return i={autoResolve:!0,patches:n.map(t=>(0,g.hZ)((t.marks||[]).filter(e=>!s.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:`Block with _key '${e._key}' contains marks (${t}) not supported by the current content model.`,action:"Remove invalid marks",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-marks.description",action:"inputs.portable-text.invalid-value.orphaned-marks.action",values:{key:e._key,orphanedMarks:s.map(e=>e.toString())}}},!0}}e.children.some((r,a)=>{if(!b(r))return i={patches:[(0,g.wC)([{_key:e._key},"children",a])],description:`Child at index '${a}' in block with key '${e._key}' is not an object.`,action:"Remove the item",item:e,i18n:{description:"inputs.portable-text.invalid-value.non-object-child.description",action:"inputs.portable-text.invalid-value.non-object-child.action",values:{key:e._key,index:a}}},!0;if(!r._key||"string"!=typeof r._key){let t={...r,_key:n()};return i={autoResolve:!0,patches:[(0,g.hZ)(t,[{_key:e._key},"children",a])],description:`Child at index ${a} is missing required _key in block with _key ${e._key}.`,action:"Set a new random _key on the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-key.description",action:"inputs.portable-text.invalid-value.missing-child-key.action",values:{key:e._key,index:a}}},!0}return r._type?o.includes(r._type)?r._type===t.span.name&&"string"!=typeof r.text&&(i={patches:[(0,g.hZ)({...r,text:""},[{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' has missing or invalid text property!`,action:"Write an empty text property to the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.invalid-span-text.description",action:"inputs.portable-text.invalid-value.invalid-span-text.action",values:{key:e._key,childKey:r._key}}},!0):(i={patches:[(0,g.wC)([{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' has invalid '_type' property (${r._type}).`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-child-type.description",action:"inputs.portable-text.invalid-value.disallowed-child-type.action",values:{key:e._key,childKey:r._key,childType:r._type}}},!0):(i={patches:[(0,g.wC)([{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' is missing '_type' property.`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-type.description",action:"inputs.portable-text.invalid-value.missing-child-type.action",values:{key:e._key,childKey:r._key}}},!0)})&&(r=!1)}return!1})&&(r=!1),{valid:r,resolution:i,value:e}):{valid:!1,resolution:{patches:[(0,g.wC)([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-array.description",action:"inputs.portable-text.invalid-value.not-an-array.action"}},value:e}}function el(e,t){let n=ec(e)||!1;W.set(e,!0),t(),W.set(e,n)}function ec(e){return W.get(e)}let ed=new WeakMap;function eh(e,t){let n=ed.get(e);ed.set(e,!1),t(),ed.set(e,n)}function ep(e){let[t,n]=e;return[t,n]}function eu(e,t){let n=e,i=t,r=n.length,o=i.length;if(0===r||0===o)return 0;r>o?n=n.substring(r-o):r<o&&(i=i.substring(0,r));let a=Math.min(r,o);if(n===i)return a;let s=0,l=1;for(let e=0;-1!==e;){let t=n.substring(a-l);if(-1===(e=i.indexOf(t)))break;l+=e,(0===e||n.substring(a-l)===i.substring(0,l))&&(s=l,l++)}return s}function ef(e,t){if(!e||!t||e[0]!==t[0])return 0;let n=0,i=Math.min(e.length,t.length),r=i,o=0;for(;n<r;)e.substring(o,r)===t.substring(o,r)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r}function ey(e,t){if(!e||!t||e[e.length-1]!==t[t.length-1])return 0;let n=0,i=Math.min(e.length,t.length),r=i,o=0;for(;n<r;)e.substring(e.length-r,e.length-o)===t.substring(t.length-r,t.length-o)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r}function eg(e,t,n,i,r){let o=e.substring(0,n),a=t.substring(0,i),s=e.substring(n),l=t.substring(i),c=eB(o,a,{checkLines:!1,deadline:r}),d=eB(s,l,{checkLines:!1,deadline:r});return c.concat(d)}function em(e,t,n){let i=e.slice(n,n+Math.floor(e.length/4)),r=-1,o="",a,s,l,c;for(;-1!==(r=t.indexOf(i,r+1));){let i=ef(e.slice(n),t.slice(r)),d=ey(e.slice(0,n),t.slice(0,r));o.length<d+i&&(o=t.slice(r-d,r)+t.slice(r,r+i),a=e.slice(0,n-d),s=e.slice(n+i),l=t.slice(0,r-d),c=t.slice(r+i))}return 2*o.length>=e.length?[a||"",s||"",l||"",c||"",o||""]:null}var ek=Object.defineProperty,eb=Object.getOwnPropertySymbols,ev=Object.prototype.hasOwnProperty,ex=Object.prototype.propertyIsEnumerable,e_=(e,t,n)=>t in e?ek(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,eE=(e,t)=>{for(var n in t||(t={}))ev.call(t,n)&&e_(e,n,t[n]);if(eb)for(var n of eb(t))ex.call(t,n)&&e_(e,n,t[n]);return e};function ew(e,t,n){var i,r;let o;if(null===e||null===t)throw Error("Null input. (diff)");let a=eB(e,t,eE({checkLines:!0,deadline:(r=(i=n||{}).timeout||1,o=1,"u">typeof r&&(o=r<=0?Number.MAX_VALUE:r),Date.now()+1e3*o)},i));return function(e){for(let t=0;t<e.length;t++){let[n,i]=e[t];if(0===i.length)continue;let r=i[0];(function(e){let t=e.charCodeAt(0);return t>=55296&&t<=56319})(i[i.length-1])&&0===n&&eA(e,t,1),function(e){let t=e.charCodeAt(0);return t>=56320&&t<=57343}(r)&&0===n&&eA(e,t,-1)}for(let t=0;t<e.length;t++)0===e[t][1].length&&e.splice(t,1)}(a),a}function eB(e,t,n){let i=e,r=t;if(i===r)return i?[[0,i]]:[];let o=ef(i,r),a=i.substring(0,o);o=ey(i=i.substring(o),r=r.substring(o));let s=i.substring(i.length-o),l=function(e,t,n){let i;if(!e)return[[1,t]];if(!t)return[[-1,e]];let r=e.length>t.length?e:t,o=e.length>t.length?t:e,a=r.indexOf(o);if(-1!==a)return i=[[1,r.substring(0,a)],[0,o],[1,r.substring(a+o.length)]],e.length>t.length&&(i[0][0]=-1,i[2][0]=-1),i;if(1===o.length)return[[-1,e],[1,t]];let s=function(e,t,n=1){let i,r,o,a,s;if(n<=0)return null;let l=e.length>t.length?e:t,c=e.length>t.length?t:e;if(l.length<4||2*c.length<l.length)return null;let d=em(l,c,Math.ceil(l.length/4)),h=em(l,c,Math.ceil(l.length/2));if(d&&h)i=d[4].length>h[4].length?d:h;else{if(!d&&!h)return null;h?d||(i=h):i=d}if(!i)throw Error("Unable to find a half match.");return e.length>t.length?(r=i[0],o=i[1],a=i[2],s=i[3]):(a=i[0],s=i[1],r=i[2],o=i[3]),[r,o,a,s,i[4]]}(e,t);if(s){let e=s[0],t=s[1],i=s[2],r=s[3],o=s[4],a=eB(e,i,n),l=eB(t,r,n);return a.concat([[0,o]],l)}return n.checkLines&&e.length>100&&t.length>100?function(e,t,n){let i=e,r=t,o=function(e,t){let n=[],i={};function r(e){let t="",r=0,a=-1,s=n.length;for(;a<e.length-1;){-1===(a=e.indexOf(`
`,r))&&(a=e.length-1);let l=e.slice(r,a+1);(i.hasOwnProperty?i.hasOwnProperty(l):void 0!==i[l])?t+=String.fromCharCode(i[l]):(s===o&&(l=e.slice(r),a=e.length),t+=String.fromCharCode(s),i[l]=s,n[s++]=l),r=a+1}return t}n[0]="";let o=4e4,a=r(e);return o=65535,{chars1:a,chars2:r(t),lineArray:n}}(i,r);i=o.chars1,r=o.chars2;let a=o.lineArray,s=eB(i,r,{checkLines:!1,deadline:n.deadline});(function(e,t){for(let n=0;n<e.length;n++){let i=e[n][1],r=[];for(let e=0;e<i.length;e++)r[e]=t[i.charCodeAt(e)];e[n][1]=r.join("")}})(s,a),(s=function(e){let t=e.map(e=>ep(e)),n=!1,i=[],r=0,o=null,a=0,s=0,l=0,c=0,d=0;for(;a<t.length;)0===t[a][0]?(i[r++]=a,s=c,l=d,c=0,d=0,o=t[a][1]):(1===t[a][0]?c+=t[a][1].length:d+=t[a][1].length,o&&o.length<=Math.max(s,l)&&o.length<=Math.max(c,d)&&(t.splice(i[r-1],0,[-1,o]),t[i[r-1]+1][0]=1,r--,a=--r>0?i[r-1]:-1,s=0,l=0,c=0,d=0,o=null,n=!0)),a++;for(n&&(t=ej(t)),t=e$(t),a=1;a<t.length;){if(-1===t[a-1][0]&&1===t[a][0]){let e=t[a-1][1],n=t[a][1],i=eu(e,n),r=eu(n,e);i>=r?(i>=e.length/2||i>=n.length/2)&&(t.splice(a,0,[0,n.substring(0,i)]),t[a-1][1]=e.substring(0,e.length-i),t[a+1][1]=n.substring(i),a++):(r>=e.length/2||r>=n.length/2)&&(t.splice(a,0,[0,e.substring(0,r)]),t[a-1][0]=1,t[a-1][1]=n.substring(0,n.length-r),t[a+1][0]=-1,t[a+1][1]=e.substring(r),a++),a++}a++}return t}(s)).push([0,""]);let l=0,c=0,d=0,h="",p="";for(;l<s.length;){switch(s[l][0]){case 1:d++,p+=s[l][1];break;case -1:c++,h+=s[l][1];break;case 0:if(c>=1&&d>=1){s.splice(l-c-d,c+d),l=l-c-d;let e=eB(h,p,{checkLines:!1,deadline:n.deadline});for(let t=e.length-1;t>=0;t--)s.splice(l,0,e[t]);l+=e.length}d=0,c=0,h="",p="";break;default:throw Error("Unknown diff operation.")}l++}return s.pop(),s}(e,t,n):function(e,t,n){let i=e.length,r=t.length,o=Math.ceil((i+r)/2),a=2*o,s=Array(a),l=Array(a);for(let e=0;e<a;e++)s[e]=-1,l[e]=-1;s[o+1]=0,l[o+1]=0;let c=i-r,d=c%2!=0,h=0,p=0,u=0,f=0;for(let y=0;y<o&&!(Date.now()>n);y++){for(let u=-y+h;u<=y-p;u+=2){let f;let g=o+u,m=(f=u===-y||u!==y&&s[g-1]<s[g+1]?s[g+1]:s[g-1]+1)-u;for(;f<i&&m<r&&e.charAt(f)===t.charAt(m);)f++,m++;if(s[g]=f,f>i)p+=2;else if(m>r)h+=2;else if(d){let r=o+c-u;if(r>=0&&r<a&&-1!==l[r]&&f>=i-l[r])return eg(e,t,f,m,n)}}for(let h=-y+u;h<=y-f;h+=2){let p;let g=o+h,m=(p=h===-y||h!==y&&l[g-1]<l[g+1]?l[g+1]:l[g-1]+1)-h;for(;p<i&&m<r&&e.charAt(i-p-1)===t.charAt(r-m-1);)p++,m++;if(l[g]=p,p>i)f+=2;else if(m>r)u+=2;else if(!d){let r=o+c-h;if(r>=0&&r<a&&-1!==s[r]){let a=s[r],l=o+a-r;if(a>=(p=i-p))return eg(e,t,a,l,n)}}}}return[[-1,e],[1,t]]}(e,t,n.deadline)}(i=i.substring(0,i.length-o),r=r.substring(0,r.length-o),n);return a&&l.unshift([0,a]),s&&l.push([0,s]),l=ej(l)}function eT(e,t,n){return 1===n?e+t:t+e}function eS(e,t){return 1===t?[e.substring(0,e.length-1),e[e.length-1]]:[e.substring(1),e[0]]}function eA(e,t,n){var i,r;let o=1===n?-1:1,a=null,s=null,l=t+n;for(;l>=0&&l<e.length&&(null===a||null===s);l+=n){let[i,r]=e[l];if(0!==r.length){if(1===i){null===a&&(a=l);continue}if(-1===i){null===s&&(s=l);continue}if(0===i){if(null===a&&null===s){let[i,r]=eS(e[t][1],n);e[t][1]=i,e[l][1]=eT(e[l][1],r,o);return}break}}}if(null!==a&&null!==s&&(i=a,r=s,1===n?e[i][1][e[i][1].length-1]===e[r][1][e[r][1].length-1]:e[i][1][0]===e[r][1][0])){let[i,r]=eS(e[a][1],o),[l]=eS(e[s][1],o);e[a][1]=i,e[s][1]=l,e[t][1]=eT(e[t][1],r,n);return}let[c,d]=eS(e[t][1],n);e[t][1]=c,null===a?(e.splice(l,0,[1,d]),null!==s&&s>=l&&s++):e[a][1]=eT(e[a][1],d,o),null===s?e.splice(l,0,[-1,d]):e[s][1]=eT(e[s][1],d,o)}let eN=/[^a-zA-Z0-9]/,eP=/\s/,eO=/[\r\n]/,eC=/\n\r?\n$/,ez=/^\r?\n\r?\n/;function e$(e){let t=e.map(e=>ep(e));function n(e,t){if(!e||!t)return 6;let n=e.charAt(e.length-1),i=t.charAt(0),r=n.match(eN),o=i.match(eN),a=r&&n.match(eP),s=o&&i.match(eP),l=a&&n.match(eO),c=s&&i.match(eO),d=l&&e.match(eC),h=c&&t.match(ez);return d||h?5:l||c?4:r&&!a&&s?3:a||s?2:r||o?1:0}let i=1;for(;i<t.length-1;){if(0===t[i-1][0]&&0===t[i+1][0]){let e=t[i-1][1],r=t[i][1],o=t[i+1][1],a=ey(e,r);if(a){let t=r.substring(r.length-a);e=e.substring(0,e.length-a),r=t+r.substring(0,r.length-a),o=t+o}let s=e,l=r,c=o,d=n(e,r)+n(r,o);for(;r.charAt(0)===o.charAt(0);){e+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);let t=n(e,r)+n(r,o);t>=d&&(d=t,s=e,l=r,c=o)}t[i-1][1]!==s&&(s?t[i-1][1]=s:(t.splice(i-1,1),i--),t[i][1]=l,c?t[i+1][1]=c:(t.splice(i+1,1),i--))}i++}return t}function ej(e){let t=e.map(e=>ep(e));t.push([0,""]);let n=0,i=0,r=0,o="",a="",s;for(;n<t.length;)switch(t[n][0]){case 1:r++,a+=t[n][1],n++;break;case -1:i++,o+=t[n][1],n++;break;case 0:i+r>1?(0!==i&&0!==r&&(0!==(s=ef(a,o))&&(n-i-r>0&&0===t[n-i-r-1][0]?t[n-i-r-1][1]+=a.substring(0,s):(t.splice(0,0,[0,a.substring(0,s)]),n++),a=a.substring(s),o=o.substring(s)),0!==(s=ey(a,o))&&(t[n][1]=a.substring(a.length-s)+t[n][1],a=a.substring(0,a.length-s),o=o.substring(0,o.length-s))),n-=i+r,t.splice(n,i+r),o.length&&(t.splice(n,0,[-1,o]),n++),a.length&&(t.splice(n,0,[1,a]),n++),n++):0!==n&&0===t[n-1][0]?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,r=0,i=0,o="",a="";break;default:throw Error("Unknown diff operation")}""===t[t.length-1][1]&&t.pop();let l=!1;for(n=1;n<t.length-1;)0===t[n-1][0]&&0===t[n+1][0]&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)===t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),l=!0):t[n][1].substring(0,t[n+1][1].length)===t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),l=!0)),n++;return l&&(t=ej(t)),t}var eD=Object.defineProperty,eK=Object.getOwnPropertySymbols,eM=Object.prototype.hasOwnProperty,eG=Object.prototype.propertyIsEnumerable,eL=(e,t,n)=>t in e?eD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,eI=(e,t)=>{for(var n in t||(t={}))eM.call(t,n)&&eL(e,n,t[n]);if(eK)for(var n of eK(t))eG.call(t,n)&&eL(e,n,t[n]);return e};let eU={threshold:.5,distance:1e3};function eR(e,t,n,i={}){if(null===e||null===t||null===n)throw Error("Null input. (match())");let r=Math.max(0,Math.min(n,e.length));return e===t?0:e.length?e.substring(r,r+t.length)===t?r:function(e,t,n,i={}){if(t.length>32)throw Error("Pattern too long for this browser.");let r=eI(eI({},eU),i),o=function(e){let t={};for(let n=0;n<e.length;n++)t[e.charAt(n)]=0;for(let n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t}(t);function a(e,i){let o=e/t.length,a=Math.abs(n-i);return r.distance?o+a/r.distance:a?1:o}let s=r.threshold,l=e.indexOf(t,n);-1!==l&&(s=Math.min(a(0,l),s),-1!==(l=e.lastIndexOf(t,n+t.length))&&(s=Math.min(a(0,l),s)));let c=1<<t.length-1;l=-1;let d,h,p=t.length+e.length,u=[];for(let i=0;i<t.length;i++){for(d=0,h=p;d<h;)a(i,n+h)<=s?d=h:p=h,h=Math.floor((p-d)/2+d);p=h;let r=Math.max(1,n-h+1),f=Math.min(n+h,e.length)+t.length,y=Array(f+2);y[f+1]=(1<<i)-1;for(let t=f;t>=r;t--){let d=o[e.charAt(t-1)];if(0===i?y[t]=(y[t+1]<<1|1)&d:y[t]=(y[t+1]<<1|1)&d|((u[t+1]|u[t])<<1|1)|u[t+1],y[t]&c){let e=a(i,t-1);if(e<=s){if(s=e,(l=t-1)>n)r=Math.max(1,2*n-l);else break}}}if(a(i+1,n)>s)break;u=y}return l}(e,t,r,i):-1}function eV(e){let t=[];for(let n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function eJ(e){let t=[];for(let n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function eY(e,t){let n=0,i=0,r=0,o=0,a;for(a=0;a<e.length&&(1!==e[a][0]&&(n+=e[a][1].length),-1!==e[a][0]&&(i+=e[a][1].length),!(n>t));a++)r=n,o=i;return e.length!==a&&-1===e[a][0]?o:o+(t-r)}function eq(e){let t=0;for(let n=0;n<e.length;n++){let i=e.codePointAt(n);if(typeof i>"u")throw Error("Failed to get codepoint");t+=eH(i)}return t}function eH(e){return e<=127?1:e<=2047?2:e<=65535?3:4}function eW(e,t){return{diffs:[],start1:e,start2:t,utf8Start1:e,utf8Start2:t,length1:0,length2:0,utf8Length1:0,utf8Length2:0}}let eQ=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;function eF(e){if(!e)return[];let t=[],n=e.split(`
`),i=0;for(;i<n.length;){let e=n[i].match(eQ);if(!e)throw Error(`Invalid patch string: ${n[i]}`);let r=eW(eZ(e[1]),eZ(e[3]));for(t.push(r),""===e[2]?(r.start1--,r.utf8Start1--,r.length1=1,r.utf8Length1=1):"0"===e[2]?(r.length1=0,r.utf8Length1=0):(r.start1--,r.utf8Start1--,r.utf8Length1=eZ(e[2]),r.length1=r.utf8Length1),""===e[4]?(r.start2--,r.utf8Start2--,r.length2=1,r.utf8Length2=1):"0"===e[4]?(r.length2=0,r.utf8Length2=0):(r.start2--,r.utf8Start2--,r.utf8Length2=eZ(e[4]),r.length2=r.utf8Length2),i++;i<n.length;){let e;let t=n[i],o=t.charAt(0);if("@"===o)break;if(""===o){i++;continue}try{e=decodeURI(t.slice(1))}catch{throw Error(`Illegal escape in parse: ${t}`)}let a=eq(e)-e.length;if("-"===o)r.diffs.push([-1,e]),r.length1-=a;else if("+"===o)r.diffs.push([1,e]),r.length2-=a;else if(" "===o)r.diffs.push([0,e]),r.length1-=a,r.length2-=a;else throw Error(`Invalid patch mode "${o}" in: ${e}`);i++}}return t}function eZ(e){return parseInt(e,10)}let eX=new WeakMap,e0=new WeakMap;function e1(e){return eX.get(e)??!1}function e2(e){return e0.get(e)??!1}let e8=()=>(function(e){let t=e3();return(function(e=16){let t=new Uint8Array(e);return(0,x.A)(t),t})(12).reduce((e,n)=>e+t[n],"").slice(0,12)})(12),e3=(()=>{let e;return()=>{if(e)return e;e=[];for(let t=0;t<256;++t)e[t]=(t+256).toString(16).slice(1);return e}})(),e6=new WeakMap;function e4(e,t){let n=e6.get(e);e6.set(e,!0),d.KE.withoutNormalizing(e,t),e6.set(e,n)}function e5(e){return e6.get(e)??!1}let e9=new WeakMap;function e7(e){return e9.get(e)?.actionSetId}let te=M("plugin:withUndoRedo"),tt=new WeakMap,tn=new WeakMap,ti=e=>{let t=tt.get(e);return void 0===t||t},tr=e=>(tn.get(e)||tn.set(e,[]),tn.get(e)||[]);function to(e,t,n,i,r){let o={...n};if("insert"===t.type&&1===t.path.length){let e=(i||[]).findIndex(e=>y({_key:e._key},t.path[0]));return te(`Adjusting block path (+${t.items.length}) for '${o.type}' operation and patch '${t.type}'`),[ta(o,t.items.length,e)]}if("unset"===t.type&&1===t.path.length){let e=(r||[]).findIndex(e=>y({_key:e._key},t.path[0]));return"path"in o&&Array.isArray(o.path)&&o.path[0]===e?(te("Skipping transformation that targeted removed block"),[]):[ta(o,-1,e)]}if("unset"===t.type&&0===t.path.length)return te(`Adjusting selection for unset everything patch and ${n.type} operation`),[];if("diffMatchPatch"===t.type){let n;let i=("set_selection"===o.type&&e.selection?n=e.children[e.selection.focus.path[0]]:"path"in o&&(n=e.children[o.path[0]]),n);return i&&y({_key:i._key},t.path[0])&&eF(t.value).forEach(e=>{let t=0,n=e.utf8Start1,{diffs:i}=e;if(i.forEach((e,r)=>{let[o,a]=e;1===o?(t+=a.length,n+=a.length):-1===o?(t-=a.length,n-=a.length):0===o&&(i.slice(r).every(([e])=>0===e)||(n+=a.length))}),"insert_text"===o.type&&n<o.offset&&(o.offset+=t),"remove_text"===o.type&&n<=o.offset-o.text.length&&(o.offset+=t),"set_selection"===o.type){let e=o.properties?.focus?{...o.properties.focus}:void 0,i=o?.properties?.anchor?{...o.properties.anchor}:void 0,r=o?.newProperties?.focus?{...o.newProperties.focus}:void 0,a=o?.newProperties?.anchor?{...o.newProperties.anchor}:void 0;(e&&i||r&&a)&&([e,i,r,a].forEach(e=>{e&&n<e.offset&&(e.offset+=t)}),e&&i&&(o.properties={focus:e,anchor:i}),r&&a&&(o.newProperties={focus:r,anchor:a}))}}),[o]}return[o]}function ta(e,t,n){let i={...e};if(n>=0&&"set_selection"!==i.type&&Array.isArray(i.path)&&i.path[0]>=n+t&&i.path[0]+t>-1){let e=[i.path[0]+t,...i.path.slice(1)];i.path=e}if("set_selection"===i.type){let e=i.properties?.focus?{...i.properties.focus}:void 0,r=i?.properties?.anchor?{...i.properties.anchor}:void 0,o=i?.newProperties?.focus?{...i.newProperties.focus}:void 0,a=i?.newProperties?.anchor?{...i.newProperties.anchor}:void 0;(e&&r||o&&a)&&([e,r,o,a].forEach(e=>{e&&e.path[0]>=n+t&&e.path[0]+t>-1&&(e.path=[e.path[0]+t,...e.path.slice(1)])}),e&&r&&(i.properties={focus:e,anchor:r}),o&&a&&(i.newProperties={focus:o,anchor:a}))}return i}let ts=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&d.wA.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&d.wA.equals(e.path,t.path)),tl=(e,t)=>!!(t&&"set_selection"===e.type&&"set_selection"===t.type),tc=e=>"set_selection"!==e.type;function td(e,t){let n=ti(e);tt.set(e,!1),t(),tt.set(e,n)}let th=M("sync machine"),tp=(0,u.SP)(({sendBack:e,input:t})=>{tf({context:t.context,sendBack:e,slateEditor:t.slateEditor,value:t.value,streamBlocks:t.streamBlocks})}),tu=(0,h.mj)({types:{context:{},input:{},events:{},emitted:{}},actions:{"assign initial value synced":(0,p.a)({initialValueSynced:!0}),"assign readOnly":(0,p.a)({readOnly:({event:e})=>((0,h.DT)(e,"update readOnly"),e.readOnly)}),"assign pending value":(0,p.a)({pendingValue:({event:e})=>((0,h.DT)(e,"update value"),e.value)}),"clear pending value":(0,p.a)({pendingValue:void 0}),"assign previous value":(0,p.a)({previousValue:({event:e})=>((0,h.DT)(e,"done syncing"),e.value)}),"emit done syncing initial value":(0,p.e)({type:"done syncing initial value"})},guards:{"initial value synced":({context:e})=>e.initialValueSynced,"is busy":({context:e})=>{let t=!e.readOnly,n=e.isProcessingLocalChanges,i=ec(e.slateEditor)??!1,r=t&&(n||i);return th("isBusy",{isBusy:r,editable:t,isProcessingLocalChanges:n,isChanging:i}),r},"value changed while syncing":({context:e,event:t})=>((0,h.DT)(t,"done syncing"),e.pendingValue!==t.value),"pending value equals previous value":({context:e})=>y(e.pendingValue,e.previousValue)},actors:{"sync value":tp}}).createMachine({id:"sync",context:({input:e})=>({initialValueSynced:!1,isProcessingLocalChanges:!1,keyGenerator:e.keyGenerator,schema:e.schema,readOnly:e.readOnly,slateEditor:e.slateEditor,pendingValue:void 0,previousValue:void 0}),on:{"has pending patches":{actions:(0,p.a)({isProcessingLocalChanges:!0})},mutation:{actions:(0,p.a)({isProcessingLocalChanges:!1})},"update readOnly":{actions:["assign readOnly"]}},type:"parallel",states:{"setting up":{initial:"syncing initial value",states:{"syncing initial value":{entry:[()=>{th("entry: syncing initial value")}],exit:[()=>{th("exit: syncing initial value")}],always:{guard:"initial value synced",target:"done syncing initial value"}},"done syncing initial value":{entry:["emit done syncing initial value",()=>{th("entry: done syncing initial value")}],exit:[()=>{th("exit: done syncing initial value")}],type:"final"}}},syncing:{initial:"idle",states:{idle:{entry:[()=>{th("entry: syncing->idle")}],exit:[()=>{th("exit: syncing->idle")}],on:{"update value":[{guard:"is busy",target:"busy",actions:["assign pending value"]},{target:"syncing",actions:["assign pending value"]}]}},busy:{entry:[()=>{th("entry: syncing->busy")}],exit:[()=>{th("exit: syncing->busy")}],after:{1e3:[{guard:"is busy",target:".",reenter:!0,actions:[()=>{th("reenter: syncing->busy")}]},{target:"syncing"}]},on:{"update value":[{actions:["assign pending value"]}]}},syncing:{entry:[()=>{th("entry: syncing->syncing")}],exit:[()=>{th("exit: syncing->syncing")}],always:{guard:"pending value equals previous value",target:"idle",actions:["clear pending value","assign initial value synced"]},invoke:{src:"sync value",id:"sync value",input:({context:e})=>({context:{keyGenerator:e.keyGenerator,previousValue:e.previousValue,readOnly:e.readOnly,schema:e.schema},slateEditor:e.slateEditor,streamBlocks:!e.initialValueSynced,value:e.pendingValue})},on:{"update value":{actions:["assign pending value"]},patch:{actions:[(0,p.e)(({event:e})=>e)]},"invalid value":{actions:[(0,p.e)(({event:e})=>e)]},"value changed":{actions:[(0,p.e)(({event:e})=>e)]},"done syncing":[{guard:"value changed while syncing",actions:["assign previous value","assign initial value synced"],reenter:!0},{target:"idle",actions:["clear pending value","assign previous value","assign initial value synced"]}]}}}}}});async function tf({context:e,sendBack:t,slateEditor:n,streamBlocks:i,value:r}){let o=!1,a=!0,s=!!n.selection;if(r&&0!==r.length||(th("Value is empty"),d.KE.withoutNormalizing(n,()=>{td(n,()=>{eh(n,()=>{s&&d.gB.deselect(n);let e=n.children.length;n.children.forEach((t,i)=>{d.gB.removeNodes(n,{at:[e-1-i]})}),d.gB.insertNodes(n,n.pteCreateTextBlock({decorators:[]}),{at:[0]}),s&&d.gB.select(n,[0,0])})})}),o=!0),r&&r.length>0){let s=Y(r,{schemaTypes:e.schema});await new Promise(l=>{d.KE.withoutNormalizing(n,()=>{el(n,()=>{eh(n,async()=>{let c=n.children.length;if(s.length<c){for(let e=c-1;e>s.length-1;e--)d.gB.removeNodes(n,{at:[e]});o=!0}for await(let[l,c]of ty({slateValue:s,streamBlocks:i})){let{blockChanged:i,blockValid:s}=function({context:e,sendBack:t,block:n,index:i,slateEditor:r,value:o}){let a=!1,s=!0,l=r.children[i],c=l&&!y(n,l);return d.KE.withoutNormalizing(r,()=>{el(r,()=>{eh(r,()=>{if(c&&s){let c=[o[i]],h=es(c,e.schema,e.keyGenerator);!h.valid&&h.resolution?.autoResolve&&h.resolution?.patches.length>0&&!e.readOnly&&e.previousValue&&e.previousValue!==o&&(console.warn(`${h.resolution.action} for block with _key '${c[0]._key}'. ${h.resolution?.description}`),h.resolution.patches.forEach(e=>{t({type:"patch",patch:e})})),h.valid||h.resolution?.autoResolve?(l._key===n._key?(th.enabled&&th("Updating block",l,n),function(e,t,n,i){if(d.gB.setNodes(e,t,{at:[i]}),e.isTextBlock(t)&&e.isTextBlock(n)){let r=n.children.length;t.children.length<r&&Array.from(Array(r-t.children.length)).forEach((t,n)=>{let o=r-1-n;o>0&&(th("Removing child"),d.gB.removeNodes(e,{at:[i,o]}))}),t.children.forEach((t,r)=>{let o=n.children[r],a=!y(t,o),s=!y(t.text,o?.text),l=[i,r];if(a){if(t._key===o?._key){th("Updating changed child",t,o),d.gB.setNodes(e,t,{at:l});let n=d.EY.isText(t)&&"span"===t._type&&d.EY.isText(o)&&"span"===o._type;n&&s?(d.gB.delete(e,{at:{focus:{path:l,offset:0},anchor:{path:l,offset:o.text.length}}}),d.gB.insertText(e,t.text,{at:l}),e.onChange()):n||(th("Updating changed inline object child",t),d.gB.setNodes(e,{_key:V},{at:[...l,0],voids:!0}))}else o?(th("Replacing child",t),d.gB.removeNodes(e,{at:[i,r]}),d.gB.insertNodes(e,t,{at:[i,r]}),e.onChange()):o||(th("Inserting new child",t),d.gB.insertNodes(e,t,{at:[i,r]}),e.onChange())}})}}(r,n,l,i)):(th.enabled&&th("Replacing block",l,n),function(e,t,n){let i=e.selection,r=i&&i.focus.path[0]===n;r&&d.gB.deselect(e),d.gB.removeNodes(e,{at:[n]}),d.gB.insertNodes(e,t,{at:[n]}),e.onChange(),r&&d.gB.select(e,i)}(r,n,i)),a=!0):(t({type:"invalid value",resolution:h.resolution,value:o}),s=!1)}if(!l&&s){let a=es([o[i]],e.schema,e.keyGenerator);th.enabled&&th("Validating and inserting new block in the end of the value",n),a.valid||a.resolution?.autoResolve?d.gB.insertNodes(r,n,{at:[i]}):(th("Invalid",a),t({type:"invalid value",resolution:a.resolution,value:o}),s=!1)}})})}),{blockChanged:a,blockValid:s}}({context:e,sendBack:t,block:l,index:c,slateEditor:n,value:r});o=i||o,a=a&&s}l()})})})})}if(!a){th("Invalid value, returning"),t({type:"done syncing",value:r});return}if(o){th("Server value changed, syncing editor");try{n.onChange()}catch(e){console.error(e),t({type:"invalid value",resolution:null,value:r}),t({type:"done syncing",value:r});return}s&&!n.selection&&(d.gB.select(n,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),n.onChange()),t({type:"value changed",value:r})}else th("Server value and editor value is equal, no need to sync.");t({type:"done syncing",value:r})}async function*ty({slateValue:e,streamBlocks:t}){let n=0;for await(let i of e)t&&await new Promise(e=>setTimeout(e,0)),yield[i,n],n++}let tg=M("component:PortableTextEditor:Synchronizer");function tm(e){let t,n,o,a,s,c,d,h,p,u,f,y,g,m,k,b;let v=(0,i.c)(40),{editorActor:x,slateEditor:_}=e,E=(0,l.d4)(e.editorActor,tb),w=(0,l.d4)(e.editorActor,tk);v[0]!==e.editorActor?(t=e.editorActor.getSnapshot(),v[0]=e.editorActor,v[1]=t):t=v[1];let B=t.context.keyGenerator;v[2]!==e.editorActor?(n=e.editorActor.getSnapshot().matches({"edit mode":"read only"}),v[2]=e.editorActor,v[3]=n):n=v[3],v[4]!==e.editorActor?(o=e.editorActor.getSnapshot(),v[4]=e.editorActor,v[5]=o):o=v[5],v[6]!==_||v[7]!==t.context.keyGenerator||v[8]!==n||v[9]!==o.context.schema?(a={input:{keyGenerator:B,readOnly:n,schema:o.context.schema,slateEditor:_}},v[6]=_,v[7]=t.context.keyGenerator,v[8]=n,v[9]=o.context.schema,v[10]=a):a=v[10];let T=(0,l.qf)(tu,a);v[11]!==x?(s=x.getSnapshot(),v[11]=x,v[12]=s):s=v[12],v[13]!==_||v[14]!==s.context.schema?(c={input:{schema:s.context.schema,slateEditor:_}},v[13]=_,v[14]=s.context.schema,v[15]=c):c=v[15];let S=(0,l.qf)(ea,c);return v[16]!==x||v[17]!==S||v[18]!==T?(d=()=>{let e=S.on("*",e=>{"has pending patches"===e.type&&T.send({type:"has pending patches"}),"mutation"===e.type&&(T.send({type:"mutation"}),x.send({type:"mutation",patches:e.patches,snapshot:e.snapshot,value:e.snapshot}))});return()=>{e.unsubscribe()}},h=[S,T,x],v[16]=x,v[17]=S,v[18]=T,v[19]=d,v[20]=h):(d=v[19],h=v[20]),(0,r.useEffect)(d,h),v[21]!==e.editorActor||v[22]!==T?(u=()=>{let t=T.on("*",t=>{switch(t.type){case"invalid value":e.editorActor.send({...t,type:"notify.invalid value"});break;case"value changed":e.editorActor.send({...t,type:"notify.value changed"});break;default:e.editorActor.send(t)}});return()=>{t.unsubscribe()}},p=[e.editorActor,T],v[21]=e.editorActor,v[22]=T,v[23]=p,v[24]=u):(p=v[23],u=v[24]),(0,r.useEffect)(u,p),v[25]!==w||v[26]!==T?(f=()=>{T.send({type:"update readOnly",readOnly:w})},y=[T,w],v[25]=w,v[26]=T,v[27]=f,v[28]=y):(f=v[27],y=v[28]),(0,r.useEffect)(f,y),v[29]!==T||v[30]!==E?(g=()=>{tg("Value from props changed, syncing new value"),T.send({type:"update value",value:E})},m=[T,E],v[29]=T,v[30]=E,v[31]=g,v[32]=m):(g=v[31],m=v[32]),(0,r.useEffect)(g,m),v[33]!==x||v[34]!==S?(k=()=>{tg("Subscribing to patch events");let e=x.on("patch",e=>{S.send(e)});return()=>{tg("Unsubscribing to patch events"),e.unsubscribe()}},v[33]=x,v[34]=S,v[35]=k):k=v[35],v[36]!==x||v[37]!==S||v[38]!==_?(b=[x,S,_],v[36]=x,v[37]=S,v[38]=_,v[39]=b):b=v[39],(0,r.useEffect)(k,b),null}function tk(e){return e.matches({"edit mode":"read only"})}function tb(e){return e.context.value}tm.displayName="Synchronizer";let tv={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},tx=[{mimeType:"application/json",serialize:({context:e,event:t})=>{let n=e.converters.find(e=>"application/x-portable-text"===e.mimeType);return n?{...n.serialize({context:e,event:t}),mimeType:"application/json",originEvent:t.originEvent}:{type:"serialization.failure",mimeType:"application/json",originEvent:t.originEvent,reason:"No application/x-portable-text Converter found"}},deserialize:({context:e,event:t})=>{let n=e.converters.find(e=>"application/x-portable-text"===e.mimeType);return n?{...n.deserialize({context:e,event:t}),mimeType:"application/json"}:{type:"deserialization.failure",mimeType:"application/json",reason:"No application/x-portable-text Converter found"}}},{mimeType:"application/x-portable-text",serialize:({context:e,event:t})=>e.selection?{type:"serialization.success",data:JSON.stringify((0,E.RJ)({blocks:e.value,selection:e.selection})),mimeType:"application/x-portable-text",originEvent:t.originEvent}:{type:"serialization.failure",mimeType:"application/x-portable-text",originEvent:t.originEvent,reason:"No selection"},deserialize:({context:e,event:t})=>{let n=JSON.parse(t.data);if(!Array.isArray(n))return{type:"deserialization.failure",mimeType:"application/x-portable-text",reason:"Data is not an array"};let i=n.flatMap(t=>{let n=(0,_.rT)({context:e,block:t,options:{refreshKeys:!0}});return n?[n]:[]});return 0===i.length&&n.length>0?{type:"deserialization.failure",mimeType:"application/x-portable-text",reason:"No blocks were parsed"}:{type:"deserialization.success",data:i,mimeType:"application/x-portable-text"}}},{mimeType:"text/html",serialize:({context:e,event:t})=>{if(!e.selection)return{type:"serialization.failure",mimeType:"text/html",originEvent:t.originEvent,reason:"No selection"};let n=(0,E.RJ)({blocks:e.value,selection:e.selection}),i=(0,B.FE)(n,{onMissingComponent:!1,components:{unknownType:({children:e})=>void 0!==e?`${e}`:""}});return""===i?{type:"serialization.failure",mimeType:"text/html",originEvent:t.originEvent,reason:"Serialized HTML is empty"}:{type:"serialization.success",data:i,mimeType:"text/html",originEvent:t.originEvent}},deserialize:({context:e,event:t})=>({type:"deserialization.success",data:(0,w.l$)(t.data,e.schema.portableText,{keyGenerator:e.keyGenerator,unstable_whitespaceOnPasteMode:e.schema.block.options.unstable_whitespaceOnPasteMode}),mimeType:"text/html"})},{mimeType:"text/plain",serialize:({context:e,event:t})=>e.selection?{type:"serialization.success",data:(0,E.RJ)({blocks:e.value,selection:e.selection}).map(t=>(0,m.L4)(t)?t.children.map(t=>t._type===e.schema.span.name?t.text:`[${e.schema.inlineObjects.find(e=>e.name===t._type)?.title??"Object"}]`).join(""):`[${e.schema.blockObjects.find(e=>e.name===t._type)?.title??"Object"}]`).join(`

`),mimeType:"text/plain",originEvent:t.originEvent}:{type:"serialization.failure",mimeType:"text/plain",originEvent:t.originEvent,reason:"No selection"},deserialize:({context:e,event:t})=>{let n=`<html><body>${String(t.data).replace(/[&<>"'`=/]/g,e=>tv[e]).split(/\n{2,}/).map(e=>e?`<p>${e.replace(/(?:\r\n|\r|\n)/g,"<br/>")}</p>`:"<p></p>").join("")}</body></html>`;return{type:"deserialization.success",data:(0,w.l$)(n,e.schema.portableText,{keyGenerator:e.keyGenerator}),mimeType:"text/plain"}}}],t_=M("operationToPatches"),tE=({action:e})=>{(0,d.bc)(e.editor,`
`)},tw=({context:e,action:t})=>{if(!t.editor.selection)return;let n=(0,P.b6)(e);for(let[,e]of[...d.KE.nodes(t.editor,{at:t.editor.selection,match:e=>n.isListBlock(e)})])d.gB.unsetNodes(t.editor,["listItem","level"],{at:e})},tB=({context:e,action:t})=>{if(!t.editor.selection)return;let n=(0,P.b6)(e);for(let[,e]of[...d.KE.nodes(t.editor,{at:t.editor.selection,match:e=>n.isTextBlock(e)})])d.gB.setNodes(t.editor,{level:1,listItem:t.listItem},{at:e})};function tT({editor:e,listItem:t}){if(!e.selection)return!1;let n=[...d.KE.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([n])=>e.isListBlock(n)&&n.listItem===t)}let tS=({context:e,action:t})=>{if(!t.editor.selection)return;let n=e.schema.styles[0].value,i=(0,P.b6)(e);for(let[,e]of[...d.KE.nodes(t.editor,{at:t.editor.selection,match:e=>i.isTextBlock(e)})])d.gB.setNodes(t.editor,{style:n},{at:e})},tA=({context:e,action:t})=>{if(!t.editor.selection)return;let n=(0,P.b6)(e);for(let[,e]of[...d.KE.nodes(t.editor,{at:t.editor.selection,match:e=>n.isTextBlock(e)})])d.gB.setNodes(t.editor,{style:t.style},{at:e})};function tN({editor:e,style:t}){if(!e.selection)return!1;let n=[...d.KE.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([e])=>e.style===t)}function tP(e){return"span"===e._type&&"text"in e&&"string"==typeof e.text&&(typeof e.marks>"u"||Array.isArray(e.marks)&&e.marks.every(e=>"string"==typeof e))}let tO=({context:e,action:t})=>{let n=t.editor,i=t.decorator,r=t.selection?U(t.selection,t.editor)??n.selection:n.selection;if(!r)return;let o=q(n.children,e.schema.block.name,et.get(n)),a=I(o,r,e.schema),s=a?(0,E.iL)({value:o,selectionPoint:a.anchor}):void 0,l=a?(0,E.iL)({value:o,selectionPoint:a.focus}):void 0;if(!s||!l)throw Error("Unable to find anchor or focus offset");if(d.Q6.isExpanded(r)){d.gB.setNodes(n,{},{at:r,match:d.EY.isText,split:!0,hanging:!0});let t=q(n.children,e.schema.block.name,et.get(n)),o=(0,_.lv)({value:t,offsets:{anchor:s,focus:l},backward:a?.backward}),c=(0,O.bu)({context:{activeDecorators:[],converters:[],keyGenerator:e.keyGenerator,schema:e.schema,selection:o,value:t}});if(!c)throw Error("Unable to find trimmed selection");let h=U(c,n);if(!h)throw Error("Unable to find new selection");for(let[e,t]of d.Q6.isRange(h)?[...d.KE.nodes(n,{at:h,match:e=>d.EY.isText(e)})]:[]){let r=[...(Array.isArray(e.marks)?e.marks:[]).filter(e=>e!==i),i];d.gB.setNodes(n,{marks:r},{at:t,match:d.EY.isText,split:!0,hanging:!0})}}else{let[e,t]=d.KE.node(n,r,{depth:1}),o=n.isTextBlock(e)&&1===e.children.length&&n.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(o){let e=o.marks??[],r=e.filter(e=>e!==i);d.gB.setNodes(n,{marks:e.length===r.length?[...e,i]:r},{at:t,match:e=>n.isTextSpan(e)})}else{let e={...d.KE.marks(n)||{}}.marks||[],t={...d.KE.marks(n)||{},marks:[...e,i]};n.marks=t}}if(n.selection){let e=n.selection;n.selection={...e}}};function tC({editor:e,blockPath:t,spanPath:n}){let i;for(let[r,o]of d.bP.children(e,t,{reverse:!0}))if(e.isTextSpan(r)&&d.wA.isBefore(o,n)){i=r;break}return i}function tz({editor:e,blockPath:t,spanPath:n}){let i;for(let[r,o]of d.bP.children(e,t))if(e.isTextSpan(r)&&d.wA.isAfter(o,n)){i=r;break}return i}let t$=M("plugin:withPortableTextMarkModel"),tj=({action:e})=>{let t=e.editor,n=e.decorator,{selection:i}=t;if(i){if(d.Q6.isExpanded(i))d.gB.setNodes(t,{},{match:d.EY.isText,split:!0,hanging:!0}),t.selection&&[...d.KE.nodes(t,{at:t.selection,match:d.EY.isText})].forEach(([e,i])=>{let r=t.children[i[0]];d.Hg.isElement(r)&&r.children.includes(e)&&d.gB.setNodes(t,{marks:(Array.isArray(e.marks)?e.marks:[]).filter(e=>e!==n),_type:"span"},{at:i})});else{let[e,r]=d.KE.node(t,i,{depth:1}),o=t.isTextBlock(e)&&1===e.children.length&&t.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(o){let e=(o.marks??[]).filter(e=>e!==n);d.gB.setNodes(t,{marks:e},{at:r,match:e=>t.isTextSpan(e)})}else{let e={...d.KE.marks(t)||{}}.marks||[],i={...d.KE.marks(t)||{},marks:e.filter(e=>e!==n)};t.marks={marks:i.marks,_type:"span"}}}if(t.selection){let e=t.selection;t.selection={...e}}}};function tD({editor:e,decorator:t}){if(!e.selection)return!1;let n=Array.from(d.KE.nodes(e,{match:d.EY.isText,at:e.selection}));return 0!==n.length&&(d.Q6.isExpanded(e.selection)?n.every(e=>{let[n]=e;return n.marks?.includes(t)}):(({...d.KE.marks(e)||{}}).marks||[]).includes(t))}let tK=M("API:editable");function tM({editor:e,annotation:t}){if(!e.selection||e.selection.focus.path.length<2)return!1;try{let n=[...d.KE.nodes(e,{at:e.selection,match:e=>d.EY.isText(e)})];if(0===n.length||n.some(([e])=>!(0,m.bn)(e)||!e.marks||e.marks?.length===0))return!1;let i=n.reduce((t,[,n])=>{let[i]=d.KE.node(e,n,{depth:1});return e.isTextBlock(i)&&i.markDefs?[...t,...i.markDefs]:t},[]);return n.every(([e])=>!!(0,m.bn)(e)&&e.marks?.map(e=>i.find(t=>t?._key===e)?._type)?.includes(t.name))}catch{return!1}}let tG=({context:e,action:t})=>{let n,i,r;let o=t.editor;if(!o.selection||d.Q6.isCollapsed(o.selection))return;let a=[];for(let[n,s]of d.KE.nodes(o,{at:o.selection,match:e=>o.isTextBlock(e),reverse:d.Q6.isBackward(o.selection)})){if(0===n.children.length||1===n.children.length&&""===n.children[0].text)continue;let l=e.keyGenerator(),c=n.markDefs??[];for(let[e,h]of(void 0===c.find(e=>e._type===t.annotation.name&&e._key===l)&&(d.gB.setNodes(o,{markDefs:[...c,{_type:t.annotation.name,_key:l,...t.annotation.value}]},{at:s}),r=[{_key:n._key},"markDefs",{_key:l}],d.Q6.isBackward(o.selection)?a.unshift(r):a.push(r)),d.gB.setNodes(o,{},{match:d.EY.isText,split:!0}),d.bP.children(o,s))){if(!o.isTextSpan(e)||!d.Q6.includes(o.selection,h))continue;let r=e.marks??[],a=r.filter(e=>c.some(n=>n._key===e&&n._type===t.annotation.name));d.gB.setNodes(o,{marks:[...r.filter(e=>!a.includes(e)),l]},{at:h}),i=[{_key:n._key},"children",{_key:e._key}]}}return r&&i&&(n={markDefPath:r,markDefPaths:a,spanPath:i}),n},tL=({action:e})=>{let t=e.editor;if(tK("Removing annotation",e.annotation.name),t.selection){if(d.Q6.isCollapsed(t.selection)){let[n,i]=d.KE.node(t,t.selection,{depth:1});if(!t.isTextBlock(n))return;let r=(n.markDefs??[]).filter(t=>t._type===e.annotation.name),[o,a]=d.KE.node(t,t.selection,{depth:2});if(!t.isTextSpan(o))return;let s=o.marks?.find(e=>r.some(t=>t._key===e));if(!s)return;let l=[];for(let[e,n]of d.bP.children(t,i,{reverse:!0}))if(t.isTextSpan(e)&&d.wA.isBefore(n,a)){if(e.marks?.includes(s))l.push([e,n]);else break}let c=[];for(let[e,n]of d.bP.children(t,i))if(t.isTextSpan(e)&&d.wA.isAfter(n,a)){if(e.marks?.includes(s))c.push([e,n]);else break}for(let[e,n]of[...l,[o,a],...c])d.gB.setNodes(t,{marks:e.marks?.filter(e=>e!==s)},{at:n})}else for(let[n,i]of(d.gB.setNodes(t,{},{match:e=>t.isTextSpan(e),split:!0,hanging:!0}),d.KE.nodes(t,{at:t.selection,match:e=>t.isTextBlock(e)})))for(let[r,o]of d.bP.children(t,i)){if(!t.isTextSpan(r)||!d.Q6.includes(t.selection,o))continue;let i=n.markDefs??[],a=r.marks??[],s=a.filter(t=>i.find(e=>e._key===t)?._type!==e.annotation.name);s.length!==a.length&&d.gB.setNodes(t,{marks:s},{at:o})}}};function tI({block:e,placement:t,editor:n,schema:i}){if(n.selection){let[r,o]=Array.from(d.KE.nodes(n,{at:n.selection.focus.path.slice(0,1),match:e=>!d.KE.isEditor(e)}))[0]??[void 0,void 0];if("after"===t){let t=[o[0]+1];d.gB.insertNodes(n,e,{at:t}),d.gB.select(n,{anchor:{path:[t[0],0],offset:0},focus:{path:[t[0],0],offset:0}})}else"before"===t?d.gB.insertNodes(n,e,{at:o}):(d.KE.insertNode(n,e),r&&H([r],i)&&d.gB.removeNodes(n,{at:o}))}else{let t=Array.from(d.KE.nodes(n,{match:e=>!d.KE.isEditor(e),at:[],reverse:!0}))[0];d.KE.insertNode(n,e),t&&H([t[0]],i)&&d.gB.removeNodes(n,{at:t[1]})}}let tU=({action:e})=>{e.dataTransfer.setData(e.mimeType,e.data)},tR=({context:e,action:t})=>{let n=Y(t.blocks,{schemaTypes:e.schema});if(!t.editor.selection)return;let[i,r]=d.KE.node(t.editor,t.editor.selection,{depth:1});if(t.editor.isTextBlock(i)&&t.editor.isTextBlock(n[0])){let{markDefs:e}=i;y(e,n[0].markDefs)||d.gB.setNodes(t.editor,{markDefs:v([...n[0].markDefs||[],...e||[]])},{at:r,mode:"lowest",voids:!1})}H(t.editor.children,e.schema)?(d.gB.splitNodes(t.editor,{at:[0,0]}),t.editor.insertFragment(n),d.gB.removeNodes(t.editor,{at:[0]})):t.editor.insertFragment(n)},tV={"annotation.add":tG,"annotation.remove":tL,"annotation.toggle":({context:e,action:t})=>{if(!tM({editor:t.editor,annotation:{name:t.annotation.name}}))return tG({context:e,action:{type:"annotation.add",annotation:t.annotation,editor:t.editor}});tL({context:e,action:{type:"annotation.remove",annotation:t.annotation,editor:t.editor}})},"block.set":({context:e,action:t})=>{let n=U({anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}},t.editor);if(!n)throw Error(`Unable to convert ${JSON.stringify(t.at)} into a Slate Range`);let i=d.KE.node(t.editor,n,{depth:1})?.[0];if(!i)throw Error(`Unable to find block at ${JSON.stringify(t.at)}`);let r=q([i],e.schema.block.name,et.get(t.editor)).at(0);if(!r)throw Error(`Unable to parse block at ${JSON.stringify(t.at)}`);let{_type:o,...a}=t.props,s=(0,_.rT)({context:e,block:{...r,...a},options:{refreshKeys:!1}});if(!s)throw Error(`Unable to update block at ${JSON.stringify(t.at)}`);let l=Y([s],{schemaTypes:e.schema})?.at(0);if(!l)throw Error("Unable to convert block to Slate value");d.gB.setNodes(t.editor,l,{at:n})},"block.unset":({context:e,action:t})=>{let n=U({anchor:{path:t.at,offset:0},focus:{path:t.at,offset:0}},t.editor);if(!n)throw Error(`Unable to convert ${JSON.stringify(t.at)} into a Slate Range`);let i=d.KE.node(t.editor,n,{depth:1})?.[0];if(!i)throw Error(`Unable to find block at ${JSON.stringify(t.at)}`);let r=q([i],e.schema.block.name,et.get(t.editor)).at(0);if(!r)throw Error(`Unable to parse block at ${JSON.stringify(t.at)}`);if((0,_.zS)(e.schema,r)){let i=t.props.filter(e=>"_type"!==e),o=(0,_.rT)({context:e,block:C(r,i),options:{refreshKeys:!1}});if(!o)throw Error(`Unable to update block at ${JSON.stringify(t.at)}`);let a={};for(let e of i)e in o?a[e]=o[e]:a[e]=void 0;d.gB.setNodes(t.editor,a,{at:n});return}let o=(0,_.rT)({context:e,block:C(r,t.props.filter(e=>"_type"!==e)),options:{refreshKeys:!1}});if(!o)throw Error(`Unable to update block at ${JSON.stringify(t.at)}`);let{_type:a,_key:s,...l}=o;d.gB.setNodes(t.editor,{_type:a,_key:s,value:l},{at:n})},blur:({action:e})=>{s.rL.blur(e.editor)},"data transfer.set":tU,"decorator.add":tO,"decorator.remove":tj,"decorator.toggle":({context:e,action:t})=>{tD({editor:t.editor,decorator:t.decorator})?tj({context:e,action:{type:"decorator.remove",editor:t.editor,decorator:t.decorator}}):tO({context:e,action:{type:"decorator.add",editor:t.editor,decorator:t.decorator}})},focus:({action:e})=>{s.rL.focus(e.editor)},delete:({action:e})=>{let t=U(e.selection,e.editor);if(!t)throw Error(`Failed to get Slate Range for selection ${JSON.stringify(e.selection)}`);(0,d.Lt)(e.editor,t),(0,d.WD)(e.editor)},"delete.backward":({action:e})=>{e.editor.deleteBackward(e.unit)},"delete.forward":({action:e})=>{(0,d.GJ)(e.editor,e.unit)},"delete.block":({action:e})=>{let t=U({anchor:{path:e.blockPath,offset:0},focus:{path:e.blockPath,offset:0}},e.editor);if(!t){console.error("Unable to find Slate range from selection points");return}d.gB.removeNodes(e.editor,{at:t})},"delete.text":({context:e,action:t})=>{let n=q(t.editor.children,e.schema.block.name,et.get(t.editor)),i=(0,_.lv)({value:n,offsets:{anchor:t.anchor,focus:t.focus}});if(!i)throw Error("Unable to find selection from block offsets");let r=(0,O.bu)({context:{converters:[],schema:e.schema,keyGenerator:e.keyGenerator,activeDecorators:[],value:n,selection:i}});if(!r)throw Error("Unable to find trimmed selection");let o=U(r,t.editor);if(!o)throw Error("Unable to find Slate range from trimmed selection");d.gB.delete(t.editor,{at:o})},"deserialization.failure":({action:e})=>{console.error(`Deserialization of ${e.mimeType} failed with reason ${e.reason}`)},"deserialization.success":({context:e,action:t})=>{tR({context:e,action:{type:"insert.blocks",blocks:t.data,editor:t.editor}})},"history.redo":({action:e})=>{let t=e.editor,{redos:n}=t.history,i=tr(t);if(n.length>0){let e=n[n.length-1];if(te("Redoing",e),e.operations.length>0){let n=i.filter(t=>t.time>=e.timestamp),r=e.operations;n.forEach(e=>{r=k(r.map(n=>to(t,e.patch,n,e.snapshot,e.previousSnapshot)))});try{d.KE.withoutNormalizing(t,()=>{!function(e,t){let n=e2(e);e0.set(e,!0),t(),e0.set(e,n)}(t,()=>{td(t,()=>{r.forEach(e=>{t.apply(e)})})})})}catch(e){te("Could not perform redo step",e),i.splice(0,i.length),d.gB.deselect(t),t.history={undos:[],redos:[]},tt.set(t,!0),e0.set(t,!1),t.onChange();return}t.history.undos.push(e),t.history.redos.pop()}}},"history.undo":({action:e})=>{let t=e.editor,{undos:n}=t.history,i=tr(t);if(n.length>0){let e=n[n.length-1];if(te("Undoing",e),e.operations.length>0){let n=i.filter(t=>t.time>=e.timestamp),r=e.operations;n.forEach(e=>{r=k(r.map(n=>to(t,e.patch,n,e.snapshot,e.previousSnapshot)))});let o=r.map(d.I.inverse).reverse();try{d.KE.withoutNormalizing(t,()=>{!function(e,t){let n=e1(e);eX.set(e,!0),t(),eX.set(e,n)}(t,()=>{td(t,()=>{o.forEach(e=>{t.apply(e)})})})})}catch(e){te("Could not perform undo step",e),i.splice(0,i.length),d.gB.deselect(t),t.history={undos:[],redos:[]},tt.set(t,!0),eX.set(t,!1),t.onChange();return}t.history.redos.push(e),t.history.undos.pop()}}},"insert.block":({context:e,action:t})=>{let n=(0,_.rT)({block:t.block,context:e,options:{refreshKeys:!1}});if(!n)throw Error(`Failed to parse block ${JSON.stringify(t.block)}`);let i=Y([n],{schemaTypes:e.schema})[0];if(!i)throw Error(`Failed to convert block to Slate fragment ${JSON.stringify(n)}`);tI({block:i,placement:t.placement,editor:t.editor,schema:e.schema})},"insert.blocks":tR,"insert.block object":({context:e,action:t})=>{tI({block:Y([{_key:e.keyGenerator(),_type:t.blockObject.name,...t.blockObject.value?t.blockObject.value:{}}],{schemaTypes:e.schema})[0],placement:t.placement,editor:t.editor,schema:e.schema})},"insert.break":({context:e,action:t})=>{let n=e.keyGenerator,i=e.schema,r=t.editor;if(!r.selection)return;let o=r.selection.anchor.path.slice(0,1),a=r.selection.focus.path.slice(0,1),s=d.bP.descendant(r,a);if(r.isTextBlock(s)&&o[0]===a[0]){d.gB.splitNodes(r,{at:r.selection});let[t,o]=d.KE.node(r,d.wA.next(a),{depth:1}),s=d.bP.child(t,0);if(r.isTextSpan(s)||d.gB.insertNodes(r,{_key:e.keyGenerator(),_type:"span",text:"",marks:[]},{at:[o[0],0]}),d.gB.setSelection(r,{anchor:{path:[...o,0],offset:0},focus:{path:[...o,0],offset:0}}),r.isTextBlock(t)&&t.markDefs&&t.markDefs.length>0){let e=new Map,s=Array.from(d.bP.children(r,a)).map(e=>e[0]).filter(e=>r.isTextSpan(e));for(let[t,a]of d.bP.children(r,o)){if(!r.isTextSpan(t))continue;let o=t.marks??[];for(let t of o)i.decorators.some(e=>e.value===t)||s.some(e=>e.marks?.includes(t))&&!e.has(t)&&e.set(t,n());let l=o.map(t=>e.get(t)??t);y(o,l)||d.gB.setNodes(r,{marks:l},{at:a})}let l=t.markDefs.map(t=>({...t,_key:e.get(t._key)??t._key}));y(t.markDefs,l)||d.gB.setNodes(r,{markDefs:l},{at:o,match:e=>r.isTextBlock(e)})}return}d.gB.splitNodes(r,{always:!0})},"insert.inline object":({context:e,action:t})=>{if(!e.schema.inlineObjects.some(e=>e.name===t.inlineObject.name)){console.error("Unable to insert unknown inline object");return}if(!t.editor.selection){console.error("Unable to insert inline object without selection");return}let[n]=Array.from(d.KE.nodes(t.editor,{at:t.editor.selection.focus.path,match:e=>t.editor.isTextBlock(e)})).at(0)??[void 0,void 0];if(!n){console.error("Unable to perform action without focus text block");return}let i=Y([{_type:e.schema.block.name,_key:e.keyGenerator(),children:[{_type:t.inlineObject.name,_key:e.keyGenerator(),...t.inlineObject.value??{}}]}],{schemaTypes:e.schema}).at(0)?.children.at(0);if(!i){console.error("Unable to insert inline object");return}d.gB.insertNodes(t.editor,i)},"insert.soft break":tE,"insert.span":({context:e,action:t})=>{if(!t.editor.selection){console.error("Unable to perform action without selection",t);return}let[n,i]=Array.from(d.KE.nodes(t.editor,{at:t.editor.selection.focus.path,match:e=>t.editor.isTextBlock(e)}))[0]??[void 0,void 0];if(!n||!i){console.error("Unable to perform action without focus block",t);return}let r=n.markDefs??[],o=t.annotations?t.annotations.map(t=>({_type:t.name,_key:e.keyGenerator(),...t.value})):void 0;o&&o.length>0&&d.gB.setNodes(t.editor,{markDefs:[...r,...o]}),d.gB.insertNodes(t.editor,{_type:"span",_key:e.keyGenerator(),text:t.text,marks:[...o?.map(e=>e._key)??[],...t.decorators??[]]})},"insert.text":({action:e})=>{(0,d.bc)(e.editor,e.text)},"insert.text block":({context:e,action:t})=>{tI({block:Y([{_key:e.keyGenerator(),_type:e.schema.block.name,style:e.schema.styles[0].value??"normal",markDefs:[],children:t.textBlock?.children?.map(t=>({...t,_key:e.keyGenerator()}))??[{_type:e.schema.span.name,_key:e.keyGenerator(),text:""}]}],{schemaTypes:e.schema})[0],editor:t.editor,schema:e.schema,placement:t.placement})},effect:({action:e})=>{e.effect()},"list item.add":tB,"list item.remove":tw,"list item.toggle":({context:e,action:t})=>{tT({editor:t.editor,listItem:t.listItem})?tw({context:e,action:{...t,type:"list item.remove"}}):tB({context:e,action:{...t,type:"list item.add"}})},"move.block":({action:e})=>{let t=[L(e.at,e.editor)[0]],n=[L(e.to,e.editor)[0]];d.gB.moveNodes(e.editor,{at:t,to:n,mode:"highest"})},"move.block down":({action:e})=>{let t=[L(e.at,e.editor)[0]],n=[d.wA.next(t)[0]];d.gB.moveNodes(e.editor,{at:t,to:n,mode:"highest"})},"move.block up":({action:e})=>{let t=[L(e.at,e.editor)[0]];if(!d.wA.hasPrevious(t))return;let n=[d.wA.previous(t)[0]];d.gB.moveNodes(e.editor,{at:t,to:n,mode:"highest"})},select:({action:e})=>{let t=U(e.selection,e.editor);t?d.gB.select(e.editor,t):d.gB.deselect(e.editor)},"select.previous block":({action:e})=>{if(!e.editor.selection){console.error("Unable to select previous block without a selection");return}let t=e.editor.selection.focus.path.slice(0,1);if(!d.wA.hasPrevious(t)){console.error("There's no previous block to select");return}let n=d.wA.previous(t);d.gB.select(e.editor,n)},"select.next block":({action:e})=>{if(!e.editor.selection){console.error("Unable to select next block without a selection");return}let t=[e.editor.selection.focus.path.slice(0,1)[0]+1];d.gB.select(e.editor,t)},"serialization.failure":({action:e})=>{console.error(`Serialization of ${e.mimeType} failed with reason ${e.reason}`)},"serialization.success":({context:e,action:t})=>{tU({context:e,action:{...t,type:"data transfer.set"}})},"style.toggle":({context:e,action:t})=>{tN({editor:t.editor,style:t.style})?tS({context:e,action:{...t,type:"style.remove"}}):tA({context:e,action:{...t,type:"style.add"}})},"style.add":tA,"style.remove":tS};function tJ({context:e,action:t}){switch(t.type){case"noop":break;case"effect":tV.effect({context:e,action:t});break;default:!function({context:e,action:t}){switch(t.type){case"annotation.add":tV["annotation.add"]({context:e,action:t});break;case"annotation.remove":tV["annotation.remove"]({context:e,action:t});break;case"annotation.toggle":tV["annotation.toggle"]({context:e,action:t});break;case"block.set":tV["block.set"]({context:e,action:t});break;case"block.unset":tV["block.unset"]({context:e,action:t});break;case"blur":tV.blur({context:e,action:t});break;case"data transfer.set":tV["data transfer.set"]({context:e,action:t});break;case"decorator.add":tV["decorator.add"]({context:e,action:t});break;case"decorator.remove":tV["decorator.remove"]({context:e,action:t});break;case"decorator.toggle":tV["decorator.toggle"]({context:e,action:t});break;case"delete":tV.delete({context:e,action:t});break;case"delete.backward":tV["delete.backward"]({context:e,action:t});break;case"delete.block":tV["delete.block"]({context:e,action:t});break;case"delete.forward":tV["delete.forward"]({context:e,action:t});break;case"delete.text":tV["delete.text"]({context:e,action:t});break;case"deserialization.failure":tV["deserialization.failure"]({context:e,action:t});break;case"deserialization.success":tV["deserialization.success"]({context:e,action:t});break;case"focus":tV.focus({context:e,action:t});break;case"history.redo":tV["history.redo"]({context:e,action:t});break;case"history.undo":tV["history.undo"]({context:e,action:t});break;case"insert.block":tV["insert.block"]({context:e,action:t});break;case"insert.blocks":tV["insert.blocks"]({context:e,action:t});break;case"insert.block object":tV["insert.block object"]({context:e,action:t});break;case"insert.inline object":tV["insert.inline object"]({context:e,action:t});break;case"insert.break":tV["insert.break"]({context:e,action:t});break;case"insert.soft break":tV["insert.soft break"]({context:e,action:t});break;case"insert.span":tV["insert.span"]({context:e,action:t});break;case"insert.text":tV["insert.text"]({context:e,action:t});break;case"insert.text block":tV["insert.text block"]({context:e,action:t});break;case"list item.add":tV["list item.add"]({context:e,action:t});break;case"list item.remove":tV["list item.remove"]({context:e,action:t});break;case"list item.toggle":tV["list item.toggle"]({context:e,action:t});break;case"move.block":tV["move.block"]({context:e,action:t});break;case"move.block down":tV["move.block down"]({context:e,action:t});break;case"move.block up":tV["move.block up"]({context:e,action:t});break;case"select":tV.select({context:e,action:t});break;case"select.previous block":tV["select.previous block"]({context:e,action:t});break;case"select.next block":tV["select.next block"]({context:e,action:t});break;case"serialization.failure":tV["serialization.failure"]({context:e,action:t});break;case"serialization.success":tV["serialization.success"]({context:e,action:t});break;case"style.add":tV["style.add"]({context:e,action:t});break;case"style.remove":tV["style.remove"]({context:e,action:t});break;default:tV["style.toggle"]({context:e,action:t})}}({context:e,action:t})}}let tY=M("applyPatches"),tq=tY.enabled&&!0;function tH(e){return"object"==typeof e&&"_key"in e}function tW(e,t){tq&&(tY(`Children ${t}:`,JSON.stringify(e.children,null,2)),tY(`Selection ${t}: `,JSON.stringify(e.selection,null,2)))}function tQ(e,t){let{block:n,path:i}=function(e,t){let n=-1,i=e.children.find((e,i)=>{let r=tH(t[0])?e._key===t[0]._key:i===t[0];return r&&(n=i),r});return i?{block:i,path:[n]}:{}}(e,t);if(!(d.Hg.isElement(n)&&"children"===t[1]))return{block:n,blockPath:i,child:void 0,childPath:void 0};let r=-1,o=n.children.find((e,n)=>{let i=tH(t[2])?e._key===t[2]._key:n===t[2];return i&&(r=n),i});return o?{block:n,child:o,blockPath:i,childPath:i?.concat(r)}:{block:n,blockPath:i,child:void 0,childPath:void 0}}let tF=M("plugin:withPatches"),tZ=M("plugin:withPlaceholderBlock"),tX=M("plugin:withPortableTextBlockStyle");M("plugin:withPortableTextSelections");let t0=M("plugin:withSchemaTypes"),t1=(e,t)=>{let{editorActor:n}=t,i=n.getSnapshot().context.schema,r=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,i){let r=i[n.path[0]],o=e.isTextBlock(r);if(1===n.path.length){let e=0===n.path[0]?"before":"after",o=i[n.path[0]-1],a=0===n.path[0]?r?._key:o?._key;return a?[(0,g.Yr)([q([n.node],t)[0]],e,[{_key:a}])]:[(0,g.Wm)(i,[]),(0,g.Yr)([q([n.node],t)[0]],"before",[n.path[0]])]}if(o&&2===n.path.length&&e.children[n.path[0]]){let e=0!==r.children.length&&r.children[n.path[1]-1]?"after":"before",i={...n.node};!i._type&&d.EY.isText(i)&&(i._type="span",i.marks=[]);let o=q([{_key:"bogus",_type:t,children:[i]}],t)[0].children[0];return[(0,g.Yr)([o],e,[{_key:r._key},"children",r.children.length<=1||!r.children[n.path[1]-1]?0:{_key:r.children[n.path[1]-1]._key}])]}return t_("Something was inserted into a void block. Not producing editor patches."),[]},insertTextPatch:function(e,t,n){t_.enabled&&t_("Operation",JSON.stringify(t,null,2));let i=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&e.isTextSpan(i.children[t.path[1]])&&i.children[t.path[1]];if(!r)throw Error("Could not find child");let o=[{_key:i._key},"children",{_key:r._key},"text"],a=n[t.path[0]],s=e.isTextBlock(a)&&a.children[t.path[1]],l=e.isTextSpan(s)?s.text:"",c=(0,g.jo)(l,r.text,o);return c.value.length?[c]:[]},mergeNodePatch:function(e,n,i){let r=[],o=i[n.path[0]],a=e.children[n.path[0]];if(1===n.path.length){if(o?._key){let i=q([e.children[n.path[0]-1]],t)[0];r.push((0,g.hZ)(i,[{_key:i._key}])),r.push((0,g.wC)([{_key:o._key}]))}else throw Error("Target key not found!")}else if(e.isTextBlock(o)&&e.isTextBlock(a)&&2===n.path.length){let t=a.children[n.path[1]-1]&&e.isTextSpan(a.children[n.path[1]-1])?a.children[n.path[1]-1]:void 0,i=o.children[n.path[1]]&&e.isTextSpan(o.children[n.path[1]])?o.children[n.path[1]]:void 0;t&&(1===o.children.filter(e=>e._key===t._key).length?r.push((0,g.hZ)(t.text,[{_key:o._key},"children",{_key:t._key},"text"])):console.warn(`Multiple spans have \`_key\` ${t._key}. It's ambiguous which one to update.`,JSON.stringify(o,null,2))),i&&(1===o.children.filter(e=>e._key===i._key).length?r.push((0,g.wC)([{_key:o._key},"children",{_key:i._key}])):console.warn(`Multiple spans have \`_key\` ${i._key}. It's ambiguous which one to remove.`,JSON.stringify(o,null,2)))}else t_("Void nodes can't be merged, not creating any patches");return r},moveNodePatch:function(e,n,i){let r=[],o=i[n.path[0]],a=i[n.newPath[0]];if(!a)return r;if(1===n.path.length){let e=n.path[0]>n.newPath[0]?"before":"after";r.push((0,g.wC)([{_key:o._key}])),r.push((0,g.Yr)([q([o],t)[0]],e,[{_key:a._key}]))}else if(2===n.path.length&&e.isTextBlock(o)&&e.isTextBlock(a)){let e=o.children[n.path[1]],i=a.children[n.newPath[1]],s=n.newPath[1]===a.children.length?"after":"before",l=q([o],t)[0].children[n.path[1]];r.push((0,g.wC)([{_key:o._key},"children",{_key:e._key}])),r.push((0,g.Yr)([l],s,[{_key:a._key},"children",{_key:i._key}]))}return r},removeNodePatch:function(e,t,n){let i=n[t.path[0]];if(1===t.path.length){if(i&&i._key)return[(0,g.wC)([{_key:i._key}])];throw Error("Block not found")}if(!e.isTextBlock(i)||2!==t.path.length)return t_("Not creating patch inside object block"),[];{let e=i.children[t.path[1]];return e?i.children.filter(e=>e._key===t.node._key).length>1?(console.warn(`Multiple spans have \`_key\` ${t.node._key}. It's ambiguous which one to remove.`,JSON.stringify(i,null,2)),[]):[(0,g.wC)([{_key:i._key},"children",{_key:e._key}])]:(t_("Span not found in editor trying to remove node"),[])}},removeTextPatch:function(e,t,n){let i=e&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&i.children[t.path[1]]||void 0,o=e.isTextSpan(r)?r:void 0;if(r&&!o)throw Error("Expected span");if(!o)throw Error("Could not find child");let a=[{_key:i._key},"children",{_key:o._key},"text"],s=n[t.path[0]],l=e.isTextBlock(s)&&s.children[t.path[1]],c=e.isTextSpan(l)&&l.text,d=(0,g.jo)(c||"",o.text,a);return d.value?[d]:[]},setNodePatch:function(e,n){if(1===n.path.length){let i=e.children[n.path[0]];if("string"!=typeof i._key)throw Error("Expected block to have a _key");let r=N({...e.children[n.path[0]],...n.newProperties},A);return[(0,g.hZ)(q([r],t)[0],[{_key:i._key}])]}if(2===n.path.length){let t=e.children[n.path[0]];if(e.isTextBlock(t)){let e=t.children[n.path[1]];if(e){let i=t._key,r=e._key,o=[],a=Object.keys(n.newProperties);return a.forEach(s=>{if(1===a.length&&"_key"===s){let r=S(n.newProperties,s);o.push((0,g.hZ)(r,[{_key:i},"children",t.children.indexOf(e),s]))}else{let e=S(n.newProperties,s);o.push((0,g.hZ)(e,[{_key:i},"children",{_key:r},s]))}}),o}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error(`Unexpected path encountered: ${JSON.stringify(n.path)}`)},splitNodePatch:function(e,n,i){let r=[],o=e.children[n.path[0]];if(!e.isTextBlock(o))throw Error(`Block with path ${JSON.stringify(n.path[0])} is not a text block and can't be split`);if(1===n.path.length){let a=i[n.path[0]];if(e.isTextBlock(a)){let i=q([e.children[n.path[0]+1]],t)[0];i&&(r.push((0,g.Yr)([i],"after",[{_key:o._key}])),a.children.slice(n.position).forEach(e=>{let t=[{_key:a._key},"children",{_key:e._key}];r.push((0,g.wC)(t))}))}return r}if(2===n.path.length){let i=o.children[n.path[1]];if(e.isTextSpan(i)){let e=q([{...o,children:o.children.slice(n.path[1]+1,n.path[1]+2)}],t)[0].children;r.push((0,g.Yr)(e,"after",[{_key:o._key},"children",{_key:i._key}])),r.push((0,g.hZ)(i.text,[{_key:o._key},"children",{_key:i._key},"text"]))}}return r}}}(i),o=function(e,t){return function(n){let{apply:i,normalizeNode:r}=n;return n.apply=t=>{if(ec(n)||e1(n)||e2(n)){i(t);return}if("split_node"===t.type){let r=[...d.bP.descendants(n)].map(([e])=>e._key);i({...t,properties:{...t.properties,_key:void 0===t.properties._key||r.includes(t.properties._key)?e.getSnapshot().context.keyGenerator():t.properties._key}});return}if("insert_node"===t.type&&!d.KE.isEditor(t.node)){let r=[...d.bP.descendants(n)].map(([e])=>e._key);i({...t,node:{...t.node,_key:void 0===t.node._key||r.includes(t.node._key)?e.getSnapshot().context.keyGenerator():t.node._key}});return}i(t)},n.normalizeNode=i=>{let[o,a]=i;if(d.Hg.isElement(o)&&o._type===t.block.name){if(!o._key){e.send({type:"normalizing"}),d.gB.setNodes(n,{_key:e.getSnapshot().context.keyGenerator()},{at:a}),e.send({type:"done normalizing"});return}for(let[t,i]of d.bP.children(n,a))if(!t._key){e.send({type:"normalizing"}),d.gB.setNodes(n,{_key:e.getSnapshot().context.keyGenerator()},{at:i}),e.send({type:"done normalizing"});return}}r(i)},n}}(n,i),a=function({editorActor:e,schemaTypes:t}){return function(n){n.isTextBlock=e=>(0,m.L4)(e)&&e._type===t.block.name,n.isTextSpan=e=>(0,m.bn)(e)&&e._type===t.span.name,n.isListBlock=e=>(0,m.U4)(e)&&e._type===t.block.name,n.isVoid=e=>t.block.name!==e._type&&(t.blockObjects.map(e=>e.name).includes(e._type)||t.inlineObjects.map(e=>e.name).includes(e._type)),n.isInline=e=>t.inlineObjects.map(e=>e.name).includes(e._type)&&"__inline"in e&&!0===e.__inline;let{normalizeNode:i}=n;return n.normalizeNode=r=>{let[o,a]=r;if(void 0===o._type&&2===a.length){t0("Setting span type on text node without a type");let i=o._key||e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),d.gB.setNodes(n,{...o,_type:t.span.name,_key:i},{at:a}),e.send({type:"done normalizing"});return}if(void 0===o._key&&(1===a.length||2===a.length)){t0("Setting missing key on child node without a key");let t=e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),d.gB.setNodes(n,{_key:t},{at:a}),e.send({type:"done normalizing"});return}i(r)},n}}({editorActor:n,schemaTypes:i}),s=function({editorActor:e,patchFunctions:t,schemaTypes:n,subscriptions:i}){let r;let o=(e,t)=>{let i=!1;tq&&(tY(`

NEW PATCH =============================================================`),tY(JSON.stringify(t,null,2)));try{switch(t.type){case"insert":i=function(e,t,n){let{block:i,child:r,blockPath:o,childPath:a}=tQ(e,t.path);if(!i||!o)return tY("Block not found"),!1;if(t.path.length>1&&"children"!==t.path[1])return tY("Ignoring patch targeting void value"),!1;if(1===t.path.length){let{items:i,position:r}=t,a=Y(i,{schemaTypes:n},ee.get(e)),s=o[0],l="after"===r?s+1:s;return tY(`Inserting blocks at path [${l}]`),tW(e,"before"),d.gB.insertNodes(e,a,{at:[l]}),tW(e,"after"),!0}let{items:s,position:l}=t;if(!r||!a)return tY("Child not found"),!1;let c=i&&Y([{...i,children:s}],{schemaTypes:n},ee.get(e)),h=a[1],p=[a[0],"after"===l?h+1:h];return tY(`Inserting children at path ${p}`),tW(e,"before"),c&&d.Hg.isElement(c[0])&&d.gB.insertNodes(e,c[0].children,{at:p}),tW(e,"after"),!0}(e,t,n);break;case"unset":i=function(e,t){if(0===t.path.length){tY("Removing everything"),tW(e,"before");let t=e.selection;return d.gB.deselect(e),e.children.forEach((t,n)=>{d.gB.removeNodes(e,{at:[n]})}),d.gB.insertNodes(e,e.pteCreateTextBlock({decorators:[]})),t&&d.gB.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),tW(e,"after"),!0}let{block:n,blockPath:i,child:r,childPath:o}=tQ(e,t.path);if(1===t.path.length){if(!n||!i)return tY("Block not found"),!1;let t=i[0];return tY(`Removing block at path [${t}]`),tW(e,"before"),d.gB.removeNodes(e,{at:[t]}),tW(e,"after"),!0}return!!e.isTextBlock(n)&&"children"===t.path[1]&&3===t.path.length&&(r&&o?(tY(`Unsetting child at path ${JSON.stringify(o)}`),tW(e,"before"),tq&&tY(`Removing child at path ${JSON.stringify(o)}`),d.gB.removeNodes(e,{at:o}),tW(e,"after"),!0):(tY("Child not found"),!1))}(e,t);break;case"set":i=function(e,t){let n=t.value;"string"==typeof t.path[3]&&((n={})[t.path[3]]=t.value);let{block:i,blockPath:r,child:o,childPath:a}=tQ(e,t.path);if(!i)return tY("Block not found"),!1;let s=e.isTextBlock(i);if(s&&t.path.length>1&&"children"!==t.path[1])return tY("Ignoring setting void value"),!1;if(tW(e,"before"),s&&o&&a){if(d.EY.isText(n)&&d.EY.isText(o)){let t=o.text;n.text!==t&&(tY("Setting text property"),e.apply({type:"remove_text",path:a,offset:0,text:t}),e.apply({type:"insert_text",path:a,offset:0,text:n.text}),e.onChange())}else tY("Setting non-text property"),e.apply({type:"set_node",path:a,properties:{},newProperties:n});return!0}if(d.Hg.isElement(i)&&1===t.path.length&&r){tY("Setting block property");let{children:t,...o}=n,{children:a,...s}=i||{children:void 0};e.apply({type:"set_node",path:r,properties:{...s},newProperties:o}),tY("Setting children"),i.children.forEach((t,n)=>{e.apply({type:"remove_node",path:r.concat(i.children.length-1-n),node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:r.concat(n),node:t})})}else if(i&&"value"in i){if(!(t.path.length>1)||"children"===t.path[1])return!1;{let n=(0,g.yl)(i.value,[{...t,path:t.path.slice(1)}]);d.gB.setNodes(e,{...i,value:n},{at:r})}}return tW(e,"after"),!0}(e,t);break;case"diffMatchPatch":i=function(e,t){let{block:n,child:i,childPath:r}=tQ(e,t.path);if(!n)return tY("Block not found"),!1;if(!i||!r)return tY("Child not found"),!1;if(!(n&&e.isTextBlock(n)&&4===t.path.length&&"children"===t.path[1]&&"text"===t.path[3])||!d.EY.isText(i))return!1;let[o]=function(e,t,n={}){if("string"==typeof e)throw Error("Patches must be an array - pass the patch to `parsePatch()` first");let i=t;if(0===e.length)return[i,[]];let r=function(e,t,n={}){let i=0,r=0;function o(e){for(;i<e;){let e=t.codePointAt(r);if(typeof e>"u")return r;i+=eH(e),e>65535?r+=2:r+=1}if(!n.allowExceedingIndices&&i!==e)throw Error("Failed to determine byte offset");return r}let a=[];for(let t of e)a.push({diffs:t.diffs.map(e=>ep(e)),start1:o(t.start1),start2:o(t.start2),utf8Start1:t.utf8Start1,utf8Start2:t.utf8Start2,length1:t.length1,length2:t.length2,utf8Length1:t.utf8Length1,utf8Length2:t.utf8Length2});return a}(e,i,{allowExceedingIndices:n.allowExceedingIndices}),o=n.margin||4,a=n.deleteThreshold||.4,s=function(e,t=4){let n="";for(let e=1;e<=t;e++)n+=String.fromCharCode(e);for(let n of e)n.start1+=t,n.start2+=t,n.utf8Start1+=t,n.utf8Start2+=t;let i=e[0],r=i.diffs;if(0===r.length||0!==r[0][0])r.unshift([0,n]),i.start1-=t,i.start2-=t,i.utf8Start1-=t,i.utf8Start2-=t,i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[0][1].length){let e=r[0][1].length,o=t-e;r[0][1]=n.substring(e)+r[0][1],i.start1-=o,i.start2-=o,i.utf8Start1-=o,i.utf8Start2-=o,i.length1+=o,i.length2+=o,i.utf8Length1+=o,i.utf8Length2+=o}if(0===(r=(i=e[e.length-1]).diffs).length||0!==r[r.length-1][0])r.push([0,n]),i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[r.length-1][1].length){let e=t-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,e),i.length1+=e,i.length2+=e,i.utf8Length1+=e,i.utf8Length2+=e}return n}(r,o);i=s+i+s,function(e,t=4){for(let n=0;n<e.length;n++){if(e[n].length1<=32)continue;let i=e[n];e.splice(n--,1);let r=i.start1,o=i.start2,a="";for(;0!==i.diffs.length;){let s=eW(r-a.length,o-a.length),l=!0;if(""!==a){let e=eq(a);s.length1=a.length,s.utf8Length1=e,s.length2=a.length,s.utf8Length2=e,s.diffs.push([0,a])}for(;0!==i.diffs.length&&s.length1<32-t;){let e=i.diffs[0][0],n=i.diffs[0][1],a=eq(n);if(1===e){s.length2+=n.length,s.utf8Length2+=a,o+=n.length;let e=i.diffs.shift();e&&s.diffs.push(e),l=!1}else -1===e&&1===s.diffs.length&&0===s.diffs[0][0]&&n.length>64?(s.length1+=n.length,s.utf8Length1+=a,r+=n.length,l=!1,s.diffs.push([e,n]),i.diffs.shift()):(a=eq(n=n.substring(0,32-s.length1-t)),s.length1+=n.length,s.utf8Length1+=a,r+=n.length,0===e?(s.length2+=n.length,s.utf8Length2+=a,o+=n.length):l=!1,s.diffs.push([e,n]),n===i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(n.length))}a=(a=eJ(s.diffs)).substring(a.length-t);let c=eV(i.diffs).substring(0,t),d=eq(c);""!==c&&(s.length1+=c.length,s.length2+=c.length,s.utf8Length1+=d,s.utf8Length2+=d,0!==s.diffs.length&&0===s.diffs[s.diffs.length-1][0]?s.diffs[s.diffs.length-1][1]+=c:s.diffs.push([0,c])),l||e.splice(++n,0,s)}}}(r,o);let l=0,c=[];for(let e=0;e<r.length;e++){let t=r[e].start2+l,n=eV(r[e].diffs),o,s=-1;if(n.length>32?-1!==(o=eR(i,n.substring(0,32),t))&&(-1===(s=eR(i,n.substring(n.length-32),t+n.length-32))||o>=s)&&(o=-1):o=eR(i,n,t),-1===o)c[e]=!1,l-=r[e].length2-r[e].length1;else{let d;if(c[e]=!0,l=o-t,d=-1===s?i.substring(o,o+n.length):i.substring(o,s+32),n===d)i=i.substring(0,o)+eJ(r[e].diffs)+i.substring(o+n.length);else{let t=ew(n,d,{checkLines:!1});if(n.length>32&&function(e){let t=0,n=0,i=0;for(let r=0;r<e.length;r++){let o=e[r][0],a=e[r][1];switch(o){case 1:n+=a.length;break;case -1:i+=a.length;break;case 0:t+=Math.max(n,i),n=0,i=0;break;default:throw Error("Unknown diff operation.")}}return t+Math.max(n,i)}(t)/n.length>a)c[e]=!1;else{t=e$(t);let n=0,a=0;for(let s=0;s<r[e].diffs.length;s++){let l=r[e].diffs[s];0!==l[0]&&(a=eY(t,n)),1===l[0]?i=i.substring(0,o+a)+l[1]+i.substring(o+a):-1===l[0]&&(i=i.substring(0,o+a)+i.substring(o+eY(t,n+l[1].length))),-1!==l[0]&&(n+=l[1].length)}}}}}return[i=i.substring(s.length,i.length-s.length),c]}(eF(t.value),i.text,{allowExceedingIndices:!0}),a=function(e,t=4){let n=e.map(e=>ep(e)),i=!1,r=[],o=0,a=null,s=0,l=!1,c=!1,d=!1,h=!1;for(;s<n.length;)0===n[s][0]?(n[s][1].length<t&&(d||h)?(r[o++]=s,l=d,c=h,a=n[s][1]):(o=0,a=null),d=!1,h=!1):(-1===n[s][0]?h=!0:d=!0,a&&(l&&c&&d&&h||a.length<t/2&&3===function(...e){return e.reduce((e,t)=>e+(t?1:0),0)}(l,c,d,h))&&(n.splice(r[o-1],0,[-1,a]),n[r[o-1]+1][0]=1,o--,a=null,l&&c?(d=!0,h=!0,o=0):(s=--o>0?r[o-1]:-1,d=!1,h=!1),i=!0)),s++;return i&&(n=ej(n)),n}(ew(i.text,o),5);tW(e,"before");let s=0;for(let[t,n]of a)1===t?(e.apply({type:"insert_text",path:r,offset:s,text:n}),s+=n.length):-1===t?e.apply({type:"remove_text",path:r,offset:s,text:n}):0===t&&(s+=n.length);return tW(e,"after"),!0}(e,t);break;default:tY("Unhandled patch",t.type)}}catch(e){console.error(e)}return i};return function(a){W.set(a,!1),ed.set(a,!0),r=[...a.children];let{apply:s}=a,l=[],c=()=>{if(0===l.length)return;let e=l;l=[];let t=!1;el(a,()=>{d.KE.withoutNormalizing(a,()=>{eh(a,()=>{td(a,()=>{e.forEach(e=>{tF.enabled&&tF(`Handling remote patch ${JSON.stringify(e)}`),t=o(a,e)})})})}),t&&(a.normalize(),a.onChange())})},h=({patches:e})=>{let t=e.filter(e=>"local"!==e.origin);0!==t.length&&(l=l.concat(t),c())};return i.push(()=>{tF("Subscribing to remote patches");let t=e.on("patches",h);return()=>{tF("Unsubscribing to remote patches"),t.unsubscribe()}}),a.apply=i=>{let o=[],l=H(r=a.children,n);s(i);let c=H(a.children,n);if(!ed.get(a))return a;switch(l&&!c&&"set_selection"!==i.type&&o.push((0,g.Yr)(r,"before",[0])),i.type){case"insert_text":o=[...o,...t.insertTextPatch(a,i,r)];break;case"remove_text":o=[...o,...t.removeTextPatch(a,i,r)];break;case"remove_node":o=[...o,...t.removeNodePatch(a,i,r)];break;case"split_node":o=[...o,...t.splitNodePatch(a,i,r)];break;case"insert_node":o=[...o,...t.insertNodePatch(a,i,r)];break;case"set_node":o=[...o,...t.setNodePatch(a,i,r)];break;case"merge_node":o=[...o,...t.mergeNodePatch(a,i,r)];break;case"move_node":o=[...o,...t.moveNodePatch(a,i,r)]}return!l&&c&&["merge_node","set_node","remove_text","remove_node"].includes(i.type)&&(o=[...o,(0,g.wC)([])],e.send({type:"notify.unset",previousValue:q(r,n.block.name,et.get(a))})),l&&o.length>0&&(o=[(0,g.Wm)([],[]),...o]),o.length>0&&o.forEach(t=>{e.send({type:"patch",patch:{...t,origin:"local"}})}),a},a}}({editorActor:n,patchFunctions:r,schemaTypes:i,subscriptions:t.subscriptions}),l=function(e){return function(t){let{apply:n}=t;return t.apply=i=>{if(e.getSnapshot().matches({"edit mode":"read only"})||ec(t)||e1(t)||e2(t)){n(i);return}let r=e.getSnapshot().context.maxBlocks??-1;r>0&&t.children.length>=r&&("insert_node"===i.type||"split_node"===i.type)&&1===i.path.length||n(i)},t}}(n),c=function(e){let{editorActor:t,blockSchemaType:n}=e;return i=>{let r=q(i.children,n.name),o=tr(i),a=e7(i);e.subscriptions.push(()=>{te("Subscribing to patches");let e=t.on("patches",({patches:e,snapshot:t})=>{let n=!1;e.forEach(e=>{if(!n&&"local"!==e.origin&&o){if("unset"===e.type&&0===e.path.length){te("Someone else cleared the content, resetting undo/redo history"),i.history={undos:[],redos:[]},o.splice(0,o.length),tt.set(i,!0),n=!0;return}o.push({patch:e,time:new Date,snapshot:t,previousSnapshot:r})}}),r=t});return()=>{te("Unsubscribing to patches"),e.unsubscribe()}}),i.history={undos:[],redos:[]};let{apply:s}=i;return i.apply=e=>{if(t.getSnapshot().matches({"edit mode":"read only"})||ec(i)||e1(i)||e2(i)){s(e);return}let{operations:n,history:r}=i,{undos:o}=r,l=o[o.length-1],c=l&&l.operations&&l.operations[l.operations.length-1],d=tl(e,c),h=ti(i),p=e7(i),u=(void 0===p||void 0!==a)&&(void 0===p||void 0===a||p===a);if(h){if(l?0===n.length&&(u=void 0===p&&void 0===a?ts(e,c)||d:u):u=!1,l&&u)l.operations.push(e);else{let t={operations:[...null===i.selection?[]:[{type:"set_selection",properties:{...i.selection},newProperties:{...i.selection}}],e],timestamp:new Date};o.push(t),te("Created new undo step",l)}for(;o.length>1e3;)o.shift();tc(e)&&(r.redos=[])}a=p,s(e)},i}}({editorActor:n,blockSchemaType:i.block,subscriptions:t.subscriptions}),h=function(e,t){return function(n){let{apply:i,normalizeNode:r}=n,o=t.decorators.map(e=>e.value);return n.normalizeNode=i=>{let[o,a]=i;if(n.isTextBlock(o))for(let[t,i]of d.bP.children(n,a)){let r=o.children[i[1]+1];if(n.isTextSpan(t)&&n.isTextSpan(r)&&t.marks?.every(e=>r.marks?.includes(e))&&r.marks?.every(e=>t.marks?.includes(e))){t$("Merging spans",JSON.stringify(t,null,2),JSON.stringify(r,null,2)),e.send({type:"normalizing"}),d.gB.mergeNodes(n,{at:[i[0],i[1]+1],voids:!0}),e.send({type:"done normalizing"});return}}if(n.isTextBlock(o)&&!Array.isArray(o.markDefs)){t$("Adding .markDefs to block node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{markDefs:[]},{at:a}),e.send({type:"done normalizing"});return}if(n.isTextSpan(o)&&!Array.isArray(o.marks)){t$("Adding .marks to span node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{marks:[]},{at:a}),e.send({type:"done normalizing"});return}if(n.isTextSpan(o)){let i=d.wA.parent(a),[r]=d.KE.node(n,i),s=t.decorators.map(e=>e.value),l=o.marks?.filter(e=>!s.includes(e));if(n.isTextBlock(r)&&""===o.text&&l&&l.length>0){t$("Removing annotations from empty span node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{marks:o.marks?.filter(e=>s.includes(e))},{at:a}),e.send({type:"done normalizing"});return}}if(n.isTextBlock(o)){let i=t.decorators.map(e=>e.value);for(let[t,r]of d.bP.children(n,a))if(n.isTextSpan(t)){let a=t.marks??[],s=a.filter(e=>!i.includes(e)&&!o.markDefs?.find(t=>t._key===e));if(s.length>0){t$("Removing orphaned annotations from span node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{marks:a.filter(e=>!s.includes(e))},{at:r}),e.send({type:"done normalizing"});return}}}if(n.isTextSpan(o)){let i=d.wA.parent(a),[r]=d.KE.node(n,i);if(n.isTextBlock(r)){let i=t.decorators.map(e=>e.value),s=o.marks??[],l=s.filter(e=>!i.includes(e)&&!r.markDefs?.find(t=>t._key===e));if(l.length>0){t$("Removing orphaned annotations from span node"),e.send({type:"normalizing"}),d.gB.setNodes(n,{marks:s.filter(e=>!l.includes(e))},{at:a}),e.send({type:"done normalizing"});return}}}if(n.isTextBlock(o)){let t=o.markDefs??[],i=new Set,r=[];for(let e of t)i.has(e._key)||(i.add(e._key),r.push(e));if(t.length!==r.length){t$("Removing duplicate markDefs"),e.send({type:"normalizing"}),d.gB.setNodes(n,{markDefs:r},{at:a}),e.send({type:"done normalizing"});return}}if(n.isTextBlock(o)&&!n.operations.some(e=>"merge_node"===e.type&&"markDefs"in e.properties&&1===e.path.length)){let t=(o.markDefs||[]).filter(e=>o.children.find(t=>d.EY.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));if(o.markDefs&&!y(t,o.markDefs)){t$("Removing markDef not in use"),e.send({type:"normalizing"}),d.gB.setNodes(n,{markDefs:t},{at:a}),e.send({type:"done normalizing"});return}}r(i)},n.apply=r=>{if(ec(n)||e1(n)||e2(n)){i(r);return}if("set_selection"===r.type&&d.KE.marks(n)&&r.properties&&r.newProperties&&r.properties.anchor&&r.properties.focus&&r.newProperties.anchor&&r.newProperties.focus){let e=d.Q6.isCollapsed({anchor:r.properties.anchor,focus:r.properties.focus}),t=d.Q6.isCollapsed({anchor:r.newProperties.anchor,focus:r.newProperties.focus});if(e&&t){let e=Array.from(d.KE.nodes(n,{mode:"lowest",at:r.properties.focus,match:e=>n.isTextSpan(e),voids:!1}))[0]?.[0],t=Array.from(d.KE.nodes(n,{mode:"lowest",at:r.newProperties.focus,match:e=>n.isTextSpan(e),voids:!1}))[0]?.[0],i=e&&t&&r.newProperties.focus.path[0]===r.properties.focus.path[0]&&r.newProperties.focus.path[1]===r.properties.focus.path[1]+1&&e.text.length===r.properties.focus.offset&&0===r.newProperties.focus.offset,o=e&&t&&r.newProperties.focus.path[0]===r.properties.focus.path[0]&&r.newProperties.focus.path[1]===r.properties.focus.path[1]-1&&0===r.properties.focus.offset&&t.text.length===r.newProperties.focus.offset;if(i||o)return}}if("insert_node"===r.type){let{selection:t}=n;if(t){let[i,a]=d.KE.node(n,t,{depth:1}),s=tC({editor:n,blockPath:a,spanPath:r.path}),l=s?s.marks?.filter(e=>!o.includes(e)):[],c=tz({editor:n,blockPath:a,spanPath:[r.path[0],r.path[1]-1]}),h=c?c.marks?.filter(e=>!o.includes(e)):[],p=l?.filter(e=>!h?.includes(e))??[],u=p.length>0;if(u&&tP(r.node)&&r.node.marks?.some(e=>p.includes(e))){d.gB.insertNodes(n,{...r.node,_key:e.getSnapshot().context.keyGenerator(),marks:r.node.marks?.filter(e=>!p.includes(e))??[]});return}let f=h?.filter(e=>!l?.includes(e))??[],y=f.length>0;if(y&&tP(r.node)&&r.node.marks?.some(e=>f.includes(e))){d.gB.insertNodes(n,{...r.node,_key:e.getSnapshot().context.keyGenerator(),marks:r.node.marks?.filter(e=>!f.includes(e))??[]});return}let g=c?.marks?.filter(e=>o.includes(e))??[];if(g.length>0&&u&&!y&&tP(r.node)&&r.node.marks?.length===0){d.gB.insertNodes(n,{...r.node,_key:e.getSnapshot().context.keyGenerator(),marks:g});return}}}if("insert_text"===r.type){let{selection:t}=n,a=!!t&&d.Q6.isCollapsed(t);if(t&&a){let[a,s]=d.KE.node(n,t,{depth:1}),[l,c]=Array.from(d.KE.nodes(n,{mode:"lowest",at:t.focus,match:e=>n.isTextSpan(e),voids:!1}))[0]??[void 0,void 0],h=l.marks??[],p=h.filter(e=>o.includes(e)),u=h.length>p.length,f=0===l.text.length,y=0===t.anchor.offset,g=t.anchor.offset===l.text.length,m=tC({editor:n,blockPath:s,spanPath:c}),k=tz({editor:n,blockPath:s,spanPath:c}),b=k?.marks?.filter(e=>!o.includes(e))??[],v=h.filter(e=>!o.includes(e)),x=!!m&&m.marks?.some(e=>!o.includes(e)),_=!!m&&m.marks?.filter(e=>!o.includes(e)).every(e=>h.includes(e)),E=!!m&&m.marks?.some(e=>!o.includes(e)&&h.includes(e)),w=!!m&&m.marks?.every(e=>h.includes(e)),B=v.some(e=>b?.includes(e));if(u&&!f){if(y){if(w||_){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:m?.marks??[]});return}if(E){i(r);return}if(!m){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:[]});return}}if(g){if(k&&B&&b.length<v.length||!B){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:k?.marks??[]});return}if(!k){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:[]});return}}}if(y&&!f&&m){d.gB.insertNodes(n,{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:r.text,marks:x?[]:(m.marks??[]).filter(e=>o.includes(e))});return}}}if("remove_text"===r.type){let{selection:e}=n;if(e&&d.Q6.isExpanded(e)){var a;let[t,s]=d.KE.node(n,e,{depth:1}),[l,c]=Array.from(d.KE.nodes(n,{mode:"lowest",at:{path:r.path,offset:r.offset},match:e=>n.isTextSpan(e),voids:!1}))[0]??[void 0,void 0];if(l&&t&&"string"==typeof(a=t)._type&&"@"!==a._type[0]&&(!("markDefs"in a)||!a.markDefs||Array.isArray(a.markDefs)&&a.markDefs.every(e=>"string"==typeof e._key))&&"children"in a&&Array.isArray(a.children)&&a.children.every(e=>"object"==typeof e&&"_type"in e)){let e=t.markDefs??[],a=l.marks??[],h=a.some(t=>e.find(e=>e._key===t)),p=r.offset+r.text.length===l.text.length,u=0===r.offset&&p,f=tC({editor:n,blockPath:s,spanPath:c}),y=tz({editor:n,blockPath:s,spanPath:c}),g=!!f&&f.marks?.some(e=>!o.includes(e)&&a.includes(e)),m=!!y&&y.marks?.some(e=>!o.includes(e)&&a.includes(e));if(h&&u&&!g&&!m){let e=(({...d.KE.marks(n)||{}}).marks||[]).filter(e=>o.includes(e));d.KE.withoutNormalizing(n,()=>{i(r),d.gB.setNodes(n,{marks:e},{at:r.path})}),n.onChange();return}}}}if("merge_node"===r.type&&1===r.path.length&&"markDefs"in r.properties&&r.properties._type===t.block.name&&Array.isArray(r.properties.markDefs)&&r.properties.markDefs.length>0&&r.path[0]-1>=0){let[e,t]=d.KE.node(n,[r.path[0]-1]);if(n.isTextBlock(e)){let o=v([...Array.isArray(e.markDefs)&&e.markDefs||[],...r.properties.markDefs]);t$("Copying markDefs over to merged block",r),d.gB.setNodes(n,{markDefs:o},{at:t,voids:!1}),i(r);return}}i(r)},n}}(n,i),p=function(e,t){let n=t.styles[0].value;return function(t){let{normalizeNode:i}=t;return t.normalizeNode=r=>{let[,o]=r;for(let i of t.operations)if("split_node"===i.type&&1===i.path.length&&t.isTextBlock(i.properties)&&i.properties.style!==n&&i.path[0]===o[0]&&!d.wA.equals(o,i.path)){let[r]=d.KE.node(t,[i.path[0]+1,0]);if(d.EY.isText(r)&&""===r.text){tX(`Normalizing split node to ${n} style`,i),e.send({type:"normalizing"}),d.gB.setNodes(t,{style:n},{at:[i.path[0]+1],voids:!1}),e.send({type:"done normalizing"});return}}i(r)},t}}(n,i),u=function({editorActor:e,schemaTypes:t}){return function(n){return n.pteCreateTextBlock=n=>Y([{_type:t.block.name,_key:e.getSnapshot().context.keyGenerator(),style:t.styles[0].value||"normal",...n.listItem?{listItem:n.listItem}:{},...n.level?{level:n.level}:{},markDefs:[],children:[{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:"",marks:n.decorators.filter(e=>t.decorators.find(({value:t})=>t===e))}]}],{schemaTypes:t})[0],n}}({editorActor:n,schemaTypes:i}),f=function(e,t){let n=null;return function(i){let r=()=>{if(n!==i.selection){let n=null;if(i.selection){let e=en.get(i.selection);e?n=e:(n=I(i.children,i.selection,t),en.set(i.selection,n))}n?e.send({type:"notify.selection",selection:n}):e.send({type:"notify.selection",selection:null})}n=i.selection},{onChange:o}=i;return i.onChange=()=>{o(),e.getSnapshot().matches({setup:"setting up"})||r()},i}}(n,i);return(function(e,t){return function(n){if(void 0!==e.getSnapshot().context.maxBlocks)return n;t.push(()=>{let t=e.on("*",t=>{switch(t.type){case"blurred":case"done loading":case"editable":case"error":case"focused":case"invalid value":case"loading":case"mutation":case"patch":case"patches":case"read only":case"ready":case"selection":case"value changed":case"unset":break;case"custom.*":e.send({type:"custom behavior event",behaviorEvent:t.event,editor:n});break;default:e.send({type:"behavior event",behaviorEvent:t,editor:n})}});return()=>{t.unsubscribe()}});let{deleteBackward:i,deleteForward:r,insertBreak:o,insertData:a,insertText:s,select:l,setFragmentData:c}=n;return n.deleteBackward=t=>{if(e5(n)){i(t);return}e.send({type:"behavior event",behaviorEvent:{type:"delete.backward",unit:t},editor:n})},n.deleteForward=t=>{if(e5(n)){r(t);return}e.send({type:"behavior event",behaviorEvent:{type:"delete.forward",unit:t},editor:n})},n.insertBreak=()=>{if(e5(n)){o();return}e.send({type:"behavior event",behaviorEvent:{type:"insert.break"},editor:n})},n.insertData=t=>{if(e5(n)){a(t);return}e.send({type:"behavior event",behaviorEvent:{type:"deserialize",dataTransfer:t},editor:n})},n.insertSoftBreak=()=>{if(e5(n)){tE({context:{keyGenerator:e.getSnapshot().context.keyGenerator,schema:e.getSnapshot().context.schema},action:{type:"insert.soft break",editor:n}});return}e.send({type:"behavior event",behaviorEvent:{type:"insert.soft break"},editor:n})},n.insertText=(t,i)=>{if(e5(n)){s(t,i);return}e.send({type:"behavior event",behaviorEvent:{type:"insert.text",text:t,options:i},editor:n,defaultActionCallback:()=>{s(t,i)}})},n.redo=()=>{if(e5(n)){tJ({context:{keyGenerator:e.getSnapshot().context.keyGenerator,schema:e.getSnapshot().context.schema},action:{type:"history.redo",editor:n}});return}e.send({type:"behavior event",behaviorEvent:{type:"history.redo"},editor:n})},n.select=t=>{if(e5(n)){l(t);return}let i=d.KE.range(n,t);e.send({type:"behavior event",behaviorEvent:{type:"select",selection:I(q(n.children,e.getSnapshot().context.schema.block.name,et.get(n)),i,e.getSnapshot().context.schema)},editor:n,defaultActionCallback:()=>{l(t)}})},n.setFragmentData=(t,i)=>{if("drag"===i||e5(n)){c(t);return}t.clearData(),e.send({type:"behavior event",behaviorEvent:{type:"serialize",dataTransfer:t,originEvent:i??"unknown"},editor:n})},n.undo=()=>{if(e5(n)){tJ({context:{keyGenerator:e.getSnapshot().context.keyGenerator,schema:e.getSnapshot().context.schema},action:{type:"history.undo",editor:n}});return}e.send({type:"behavior event",behaviorEvent:{type:"history.undo"},editor:n})},n}})(n,t.subscriptions)(a(o(h(p(function(e){let{apply:t}=e;return e.apply=i=>{if(n.getSnapshot().matches({"edit mode":"read only"})||ec(e)||e1(e)||e2(e)){t(i);return}if("remove_node"===i.type){let t=i.node;if(0===i.path[0]&&d.KE.isVoid(e,t)){let t=d.wA.next(i.path);e.children[t[0]]||(tZ("Adding placeholder block"),d.KE.insertNode(e,e.pteCreateTextBlock({decorators:[]})))}}t(i)},e}(u(l(c(s(f(e)))))))))))},t2=M("component:PortableTextEditor:SlateContainer"),t8=new WeakMap,t3=(0,$.Ke)({on:"annotation.toggle",guard:({context:e,event:t})=>(0,O.kK)(t.annotation.name)({context:e}),actions:[({event:e})=>[(0,$.xl)({type:"annotation.remove",annotation:e.annotation})]]}),t6=(0,$.Ke)({on:"annotation.toggle",guard:({context:e,event:t})=>!(0,O.kK)(t.annotation.name)({context:e}),actions:[({event:e})=>[(0,$.xl)({type:"annotation.add",annotation:e.annotation})]]}),t4=(0,$.Ke)({on:"decorator.toggle",guard:({context:e,event:t})=>(0,O.Y1)(t.decorator)({context:e}),actions:[({event:e})=>[(0,$.xl)({type:"decorator.remove",decorator:e.decorator})]]}),t5=(0,$.Ke)({on:"decorator.toggle",guard:({context:e,event:t})=>!(0,O.Y1)(t.decorator)({context:e}),actions:[({event:e})=>[(0,$.xl)({type:"decorator.add",decorator:e.decorator})]]}),t9=(0,$.Ke)({on:"list item.toggle",guard:({context:e,event:t})=>(0,O.oZ)(t.listItem)({context:e}),actions:[({event:e})=>[(0,$.xl)({type:"list item.remove",listItem:e.listItem})]]}),t7=(0,$.Ke)({on:"list item.toggle",guard:({context:e,event:t})=>!(0,O.oZ)(t.listItem)({context:e}),actions:[({event:e})=>[(0,$.xl)({type:"list item.add",listItem:e.listItem})]]}),ne=(0,$.Ke)({on:"style.toggle",guard:({context:e,event:t})=>(0,O.ER)(t.style)({context:e}),actions:[({event:e})=>[(0,$.xl)({type:"style.remove",style:e.style})]]}),nt=(0,$.Ke)({on:"style.toggle",guard:({context:e,event:t})=>!(0,O.ER)(t.style)({context:e}),actions:[({event:e})=>[(0,$.xl)({type:"style.add",style:e.style})]]}),nn=(0,$.Ke)({on:"deserialize",guard:({context:e,event:t})=>{let n=e.converters.flatMap(n=>{let i=t.dataTransfer.getData(n.mimeType);return i?[n.deserialize({context:e,event:{type:"deserialize",data:i}})]:[]});return n.find(e=>"deserialization.success"===e.type)||{type:"deserialization.failure",mimeType:"*/*",reason:n.map(e=>"deserialization.failure"===e.type?e.reason:"").join(", ")}},actions:[({event:e},t)=>[(0,$.xl)({...t,dataTransfer:e.dataTransfer})]]}),ni=[t3,t6,t4,t5,t9,t7,ne,nt,nn,(0,$.Ke)({on:"deserialization.success",actions:[({event:e})=>[(0,$.xl)({type:"insert.blocks",blocks:e.data})]]}),(0,$.Ke)({on:"serialize",guard:({context:e,event:t})=>{if(0===e.converters.length)return!1;let n=e.converters.map(n=>n.serialize({context:e,event:t}));return 0!==n.length&&n},actions:[({event:e},t)=>t.map(t=>(0,$.xl)({...t,dataTransfer:e.dataTransfer}))]}),(0,$.Ke)({on:"serialization.success",actions:[({event:e})=>[(0,$.xl)({type:"data transfer.set",data:e.data,dataTransfer:e.dataTransfer,mimeType:e.mimeType})]]})],nr={lineBreak:e=>"Enter"===e.key&&e.shiftKey},no=[(0,$.Ke)({on:"key.down",guard:({event:e})=>nr.lineBreak(e.keyboardEvent),actions:[()=>[(0,$.xl)({type:"insert.soft break"})]]})];function na({schema:e,slateEditorInstance:t}){let n=e.decorators.map(e=>e.value);return(({...d.KE.marks(t)??{}}).marks??[]).filter(e=>n.includes(e))}let ns=(0,h.mj)({types:{context:{},events:{},emitted:{},input:{}},actions:{"add behavior to context":(0,p.a)({behaviors:({context:e,event:t})=>((0,h.DT)(t,"add behavior"),new Set([...e.behaviors,t.behavior]))}),"remove behavior from context":(0,p.a)({behaviors:({context:e,event:t})=>((0,h.DT)(t,"remove behavior"),e.behaviors.delete(t.behavior),new Set([...e.behaviors]))}),"assign behaviors":(0,p.a)({behaviors:({event:e})=>((0,h.DT)(e,"update behaviors"),new Set([...e.behaviors]))}),"assign schema":(0,p.a)({schema:({event:e})=>((0,h.DT)(e,"update schema"),e.schema)}),"emit patch event":(0,p.e)(({event:e})=>((0,h.DT)(e,"patch"),e)),"emit mutation event":(0,p.e)(({event:e})=>((0,h.DT)(e,"mutation"),e)),"emit read only":(0,p.e)({type:"read only"}),"emit editable":(0,p.e)({type:"editable"}),"defer event":(0,p.a)({pendingEvents:({context:e,event:t})=>((0,h.DT)(t,["patch","mutation"]),[...e.pendingEvents,t])}),"emit pending events":(0,p.b)(({context:e,enqueue:t})=>{for(let n of e.pendingEvents)t((0,p.e)(n))}),"emit ready":(0,p.e)({type:"ready"}),"clear pending events":(0,p.a)({pendingEvents:[]}),"handle behavior event":(0,p.b)(({context:e,event:t,enqueue:n})=>{(0,h.DT)(t,["behavior event","custom behavior event"]);let i="custom behavior event"===t.type||"copy"===t.behaviorEvent.type||"deserialize"===t.behaviorEvent.type||"key.down"===t.behaviorEvent.type||"key.up"===t.behaviorEvent.type||"paste"===t.behaviorEvent.type||"serialize"===t.behaviorEvent.type?void 0:{...t.behaviorEvent,editor:t.editor},r="behavior event"===t.type?t.defaultActionCallback:void 0,o=[...no,...e.behaviors.values(),...ni].filter(e=>e.on===t.behaviorEvent.type);if(0===o.length){if(r){e4(t.editor,()=>{try{r()}catch(e){console.error(Error(`Performing action "${t.behaviorEvent.type}" failed due to: ${e.message}`))}});return}if(!i)return;e4(t.editor,()=>{try{tJ({context:e,action:i})}catch(e){console.error(Error(`Performing action "${i.type}" as a result of "${t.behaviorEvent.type}" failed due to: ${e.message}`))}}),t.editor.onChange();return}let a=function({converters:e,editor:t,keyGenerator:n,schema:i}){let r=q(t.children,i.block.name,et.get(t)),o=I(r,t.selection,i);return{context:{activeDecorators:na({schema:i,slateEditorInstance:t}),converters:e,keyGenerator:n,schema:i,selection:o,value:r}}}({converters:[...e.converters],editor:t.editor,keyGenerator:e.keyGenerator,schema:e.schema}),s=!1;for(let i of o){let r=void 0===i.guard||i.guard({context:a.context,event:t.behaviorEvent});if(r){for(let o of i.actions.map(e=>e({context:a.context,event:t.behaviorEvent},r)))s=s||o.length>0&&o.some(e=>"effect"!==e.type),function(e,t){let n=e9.get(e);e9.set(e,{actionSetId:e8()}),e4(e,t),e9.set(e,n)}(t.editor,()=>{for(let i of o){if("raise"===i.type){(0,$.Cg)(i.event)?n.raise({type:"custom behavior event",behaviorEvent:i.event,editor:t.editor}):n.raise({type:"behavior event",behaviorEvent:i.event,editor:t.editor});continue}let r={...i,editor:t.editor};try{tJ({context:e,action:r})}catch(e){console.error(Error(`Performing action "${r.type}" as a result of "${t.behaviorEvent.type}" failed due to: ${e.message}`));break}}}),t.editor.onChange();if(s){t.nativeEvent?.preventDefault();break}}}if(!s){if(r){e4(t.editor,()=>{try{r()}catch(e){console.error(Error(`Performing "${t.behaviorEvent.type}" failed due to: ${e.message}`))}});return}if(!i)return;e4(t.editor,()=>{try{tJ({context:e,action:i})}catch(e){console.error(Error(`Performing action "${i.type}" as a result of "${t.behaviorEvent.type}" failed due to: ${e.message}`))}}),t.editor.onChange()}})}}).createMachine({id:"editor",context:({input:e})=>({behaviors:new Set([...e.behaviors??$.Zy]),converters:new Set(e.converters??[]),keyGenerator:e.keyGenerator,pendingEvents:[],schema:e.schema,selection:null,initialReadOnly:e.readOnly??!1,maxBlocks:e.maxBlocks,value:e.value}),on:{"notify.blurred":{actions:(0,p.e)(({event:e})=>({...e,type:"blurred"}))},"notify.done loading":{actions:(0,p.e)({type:"done loading"})},"notify.error":{actions:(0,p.e)(({event:e})=>({...e,type:"error"}))},"notify.invalid value":{actions:(0,p.e)(({event:e})=>({...e,type:"invalid value"}))},"notify.focused":{actions:(0,p.e)(({event:e})=>({...e,type:"focused"}))},"notify.selection":{actions:[(0,p.a)({selection:({event:e})=>e.selection}),(0,p.e)(({event:e})=>({...e,type:"selection"}))]},"notify.unset":{actions:(0,p.e)(({event:e})=>({...e,type:"unset"}))},"notify.loading":{actions:(0,p.e)({type:"loading"})},"notify.value changed":{actions:(0,p.e)(({event:e})=>({...e,type:"value changed"}))},"add behavior":{actions:"add behavior to context"},"remove behavior":{actions:"remove behavior from context"},patches:{actions:(0,p.e)(({event:e})=>e)},"update behaviors":{actions:"assign behaviors"},"update key generator":{actions:(0,p.a)({keyGenerator:({event:e})=>e.keyGenerator})},"update schema":{actions:"assign schema"},"update value":{actions:(0,p.a)({value:({event:e})=>e.value})},"update maxBlocks":{actions:(0,p.a)({maxBlocks:({event:e})=>e.maxBlocks})}},type:"parallel",states:{"edit mode":{initial:"read only",states:{"read only":{initial:"determine initial edit mode",on:{"behavior event":{actions:"handle behavior event",guard:({event:e})=>"copy"===e.behaviorEvent.type||"data transfer.set"===e.behaviorEvent.type||"serialize"===e.behaviorEvent.type||"serialization.failure"===e.behaviorEvent.type||"serialization.success"===e.behaviorEvent.type||"select"===e.behaviorEvent.type}},states:{"determine initial edit mode":{on:{"done syncing initial value":[{target:"#editor.edit mode.read only.read only",guard:({context:e})=>e.initialReadOnly},{target:"#editor.edit mode.editable"}]}},"read only":{on:{"update readOnly":{guard:({event:e})=>!e.readOnly,target:"#editor.edit mode.editable",actions:["emit editable"]}}}}},editable:{on:{"update readOnly":{guard:({event:e})=>e.readOnly,target:"#editor.edit mode.read only.read only",actions:["emit read only"]},"behavior event":{actions:"handle behavior event"},"custom behavior event":{actions:"handle behavior event"},"annotation.*":{actions:(0,p.e)(({event:e})=>e)},"block.*":{actions:(0,p.e)(({event:e})=>e)},blur:{actions:(0,p.e)(({event:e})=>e)},"custom.*":{actions:(0,p.e)(({event:e})=>({type:"custom.*",event:e}))},"decorator.*":{actions:(0,p.e)(({event:e})=>e)},"delete.*":{actions:(0,p.e)(({event:e})=>e)},focus:{actions:(0,p.e)(({event:e})=>e)},"history.*":{actions:(0,p.e)(({event:e})=>e)},"insert.*":{actions:(0,p.e)(({event:e})=>e)},"list item.*":{actions:(0,p.e)(({event:e})=>e)},"move.*":{actions:(0,p.e)(({event:e})=>e)},select:{actions:(0,p.e)(({event:e})=>e)},"select.*":{actions:(0,p.e)(({event:e})=>e)},"style.*":{actions:(0,p.e)(({event:e})=>e)},"text block.*":{actions:(0,p.e)(({event:e})=>e)}}}}},setup:{initial:"setting up",states:{"setting up":{exit:["emit ready"],on:{patch:{actions:"defer event"},mutation:{actions:"defer event"},"done syncing initial value":{target:"pristine"}}},pristine:{initial:"idle",states:{idle:{on:{normalizing:{target:"normalizing"},patch:{actions:"defer event",target:"#editor.setup.dirty"},mutation:{actions:"defer event",target:"#editor.setup.dirty"}}},normalizing:{on:{"done normalizing":{target:"idle"},patch:{actions:"defer event"},mutation:{actions:"defer event"}}}}},dirty:{entry:["emit pending events","clear pending events"],on:{patch:{actions:"emit patch event"},mutation:{actions:"emit mutation event"}}}}}}});function nl(e){return{behaviors:e.behaviors,converters:tx,keyGenerator:e.keyGenerator??e8,maxBlocks:e.maxBlocks,readOnly:e.readOnly,schema:e.schemaDefinition?function(e){let t=e?.blockObjects?.map(e=>m.U8({type:"object",name:"image"===e.name?"tmp-image":e.name,title:"image"===e.name&&void 0===e.title?"Image":e.title,fields:[]}))??[],n=e?.inlineObjects?.map(e=>m.U8({type:"object",name:e.name,title:e.title,fields:[]}))??[],i=(0,m.MI)({type:"array",name:"portable-text",of:[...t.map(e=>({type:e.name})),{type:"block",name:"block",of:n.map(e=>({type:e.name})),marks:{decorators:e?.decorators?.map(e=>({title:e.title??z(e.name),value:e.name}))??[],annotations:e?.annotations?.map(e=>({name:e.name,type:"object",title:e.title}))??[]},lists:e?.lists?.map(e=>({value:e.name,title:e.title??z(e.name)}))??[],styles:e?.styles?.map(e=>({value:e.name,title:e.title??z(e.name)}))??[]}]}),r=D(T.S.compile({types:[i,...t,...n]}).get("portable-text"));return{...r,blockObjects:r.blockObjects.map(e=>"tmp-image"===e.name?{...e,name:"image",type:{...e.type,name:"image"}}:e)}}(e.schemaDefinition):D(e.schema.hasOwnProperty("jsonType")?e.schema:eo(e.schema)),value:e.initialValue}}function nc(e){let t=function(e){let t=t8.get(e.editorActor);if(t)return t2("Reusing existing Slate editor instance",e.editorActor.id),t;t2("Creating new Slate editor instance",e.editorActor.id);let n=[],i=[],r=t1((0,s.o$)((0,d.ie)()),{editorActor:e.editorActor,subscriptions:i});for(let e of(et.set(r,{}),ee.set(r,{}),i))n.push(e());let o=[r.pteCreateTextBlock({decorators:[]})],a={instance:r,initialValue:o};return t8.set(e.editorActor,a),a}({editorActor:e});return{getSnapshot:()=>(function({editorActorSnapshot:e,slateEditorInstance:t}){return{context:{converters:[...e.context.converters],activeDecorators:na({schema:e.context.schema,slateEditorInstance:t}),keyGenerator:e.context.keyGenerator,schema:e.context.schema,selection:e.context.selection,value:function({editorActorSnapshot:e,slateEditorInstance:t}){return q(t.children,e.context.schema.block.name,et.get(t))}({editorActorSnapshot:e,slateEditorInstance:t})}}})({editorActorSnapshot:e.getSnapshot(),slateEditorInstance:t.instance}),registerBehavior:t=>(e.send({type:"add behavior",behavior:t.behavior}),()=>{e.send({type:"remove behavior",behavior:t.behavior})}),send:t=>{e.send(t)},on:(t,n)=>e.on(t,e=>{switch(e.type){case"blurred":case"done loading":case"editable":case"error":case"focused":case"invalid value":case"loading":case"mutation":case"patch":case"read only":case"ready":case"selection":case"value changed":n(e)}}),_internal:{editable:function(e,t){let n=t.getSnapshot().context.schema;return{focus:()=>{t.send({type:"behavior event",behaviorEvent:{type:"focus"},editor:e})},blur:()=>{t.send({type:"behavior event",behaviorEvent:{type:"blur"},editor:e})},toggleMark:n=>{t.send({type:"behavior event",behaviorEvent:{type:"decorator.toggle",decorator:n},editor:e})},toggleList:n=>{t.send({type:"behavior event",behaviorEvent:{type:"list item.toggle",listItem:n},editor:e})},toggleBlockStyle:n=>{t.send({type:"behavior event",behaviorEvent:{type:"style.toggle",style:n},editor:e})},isMarkActive:t=>{try{return tD({editor:e,decorator:t})}catch(e){return console.warn(e),!1}},marks:()=>({...d.KE.marks(e)||{}}).marks||[],undo:()=>{t.send({type:"behavior event",behaviorEvent:{type:"history.undo"},editor:e})},redo:()=>{t.send({type:"behavior event",behaviorEvent:{type:"history.redo"},editor:e})},select:t=>{let n=U(t,e);n?d.gB.select(e,n):d.gB.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection){let t=d.bP.descendant(e,e.selection.focus.path.slice(0,1));if(t)return q([t],n.block.name,et.get(e))[0]}},focusChild:()=>{if(e.selection){let t=d.bP.descendant(e,e.selection.focus.path.slice(0,1));if(t&&e.isTextBlock(t))return q([t],n.block.name,et.get(e))[0].children[e.selection.focus.path[1]]}},insertChild:(i,r)=>{if(i.name!==n.span.name)return t.send({type:"behavior event",behaviorEvent:{type:"insert.inline object",inlineObject:{name:i.name,value:r}},editor:e}),I(q(e.children,n.block.name,et.get(e)),e.selection,n)?.focus.path??[];if(!e.selection)throw Error("The editor has no selection");let[o]=Array.from(d.KE.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===n.block.name}))[0]||[void 0];if(!o)throw Error("No focused text block");if(i.name!==n.span.name&&!n.inlineObjects.some(e=>e.name===i.name))throw Error("This type cannot be inserted as a child to a text block");let a=Y([{_key:t.getSnapshot().context.keyGenerator(),_type:n.block.name,children:[{_key:t.getSnapshot().context.keyGenerator(),_type:i.name,...r||{}}]}],{schemaTypes:t.getSnapshot().context.schema})[0].children[0],s=e.selection.focus.path.slice(0,2),l=a._type===n.span.name,c=d.bP.get(e,s);return l&&c._type!==n.span.name&&(tK("Inserting span child next to inline object child, moving selection + 1"),e.move({distance:1,unit:"character"})),d.gB.insertNodes(e,a,{select:!0,at:e.selection}),e.onChange(),I(q(e.children,n.block.name,et.get(e)),e.selection,n)?.focus.path||[]},insertBlock:(i,r)=>(t.send({type:"behavior event",behaviorEvent:{type:"insert.block object",blockObject:{name:i.name,value:r},placement:"auto"},editor:e}),I(q(e.children,n.block.name,et.get(e)),e.selection,n)?.focus.path??[]),hasBlockStyle:t=>{try{return tN({editor:e,style:t})}catch{return!1}},hasListStyle:t=>{try{return tT({editor:e,listItem:t})}catch{return!1}},isVoid:e=>![n.block.name,n.span.name].includes(e._type),findByPath:t=>{let i=U({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(i){let[r,o]=d.KE.node(e,i.focus.path.slice(0,1));if(r&&o&&"string"==typeof r._key){if(1===t.length&&1===i.focus.path.length)return[q([r],n.block.name)[0],[{_key:r._key}]];let o=q([r],n.block.name,et.get(e))[0];if(e.isTextBlock(o)){let e=o.children[i.focus.path[1]];if(e)return[e,[{_key:r._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[i]=Array.from(d.KE.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=s.rL.toDOMNode(e,i)}catch{}return n},activeAnnotations:()=>{if(!e.selection||e.selection.focus.path.length<2)return[];try{let t=[];for(let[n,i]of d.KE.nodes(e,{at:e.selection,match:e=>d.EY.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})){let[r]=d.KE.node(e,i,{depth:1});e.isTextBlock(r)&&r.markDefs?.forEach(e=>{d.EY.isText(n)&&n.marks&&Array.isArray(n.marks)&&n.marks.includes(e._key)&&t.push(e)})}return t}catch{return[]}},isAnnotationActive:t=>tM({editor:e,annotation:{name:t}}),addAnnotation:(i,r)=>{let o;return d.KE.withoutNormalizing(e,()=>{o=tG({context:{keyGenerator:t.getSnapshot().context.keyGenerator,schema:n},action:{type:"annotation.add",annotation:{name:i.name,value:r??{}},editor:e}})}),e.onChange(),o},delete:(t,i)=>{if(t){let r=U(t,e);if(!(r&&r.anchor.path.length>0&&r.focus.path.length>0))throw Error("Invalid range");if(r){if(!i?.mode||i?.mode==="selected"){tK("Deleting content in selection"),d.gB.delete(e,{at:r,hanging:!0,voids:!0}),e.onChange();return}i?.mode==="blocks"&&(tK("Deleting blocks touched by selection"),d.gB.removeNodes(e,{at:r,voids:!0,match:t=>e.isTextBlock(t)||!e.isTextBlock(t)&&d.Hg.isElement(t)})),i?.mode==="children"&&(tK("Deleting children touched by selection"),d.gB.removeNodes(e,{at:r,voids:!0,match:t=>t._type===n.span.name||!e.isTextBlock(t)&&d.Hg.isElement(t)})),0===e.children.length&&(e.children=[e.pteCreateTextBlock({decorators:[]})]),e.onChange()}}},removeAnnotation:n=>{t.send({type:"behavior event",behaviorEvent:{type:"annotation.remove",annotation:{name:n.name}},editor:e})},getSelection:()=>{let t=null;if(e.selection){let i=en.get(e.selection);if(i)return i;t=I(q(e.children,n.block.name,et.get(e)),e.selection,n),en.set(e.selection,t)}return t},getValue:()=>q(e.children,n.block.name,et.get(e)),isCollapsedSelection:()=>!!e.selection&&d.Q6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&d.Q6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()},getFragment:()=>q(e.getFragment(),n.block.name),isSelectionsOverlapping:(t,n)=>{let i=U(t,e),r=U(n,e);return d.Q6.isRange(i)&&d.Q6.isRange(r)&&d.Q6.includes(i,r)}}}(t.instance,e),editorActor:e,slateEditor:t}}}let nd=(0,r.createContext)({}),nh=(0,r.createContext)(null),np=()=>{let e=(0,r.useContext)(nh);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},nu=M("component:PortableTextEditor:SelectionProvider");function nf(e){let t,n,o;let s=(0,i.c)(6),[l,c]=(0,r.useState)(null);return s[0]!==e.editorActor?(t=()=>{nu("Subscribing to selection changes");let t=e.editorActor.on("selection",e=>{(0,r.startTransition)(()=>{c(e.selection)})});return()=>{nu("Unsubscribing to selection changes"),t.unsubscribe()}},n=[e.editorActor],s[0]=e.editorActor,s[1]=t,s[2]=n):(t=s[1],n=s[2]),(0,r.useEffect)(t,n),s[3]!==e.children||s[4]!==l?(o=(0,a.jsx)(nh.Provider,{value:l,children:e.children}),s[3]=e.children,s[4]=l,s[5]=o):o=s[5],o}let ny=M("component:PortableTextEditor");class ng extends r.Component{static displayName="PortableTextEditor";change$=new j.B;constructor(e){super(e),e.editor?this.editor=e.editor:this.editor=function(e){let t=(0,f.A)(ns,{input:nl(e)});return t.start(),nc(t)}({keyGenerator:e.keyGenerator??e8,schema:e.schemaType,initialValue:e.value,maxBlocks:void 0===e.maxBlocks?void 0:Number.parseInt(e.maxBlocks.toString(),10),readOnly:e.readOnly}),this.schemaTypes=this.editor._internal.editorActor.getSnapshot().context.schema,this.editable=this.editor._internal.editable}componentDidUpdate(e){this.props.editor||e.editor||this.props.schemaType===e.schemaType||(this.schemaTypes=D(this.props.schemaType.hasOwnProperty("jsonType")?this.props.schemaType:eo(this.props.schemaType)),this.editor._internal.editorActor.send({type:"update schema",schema:this.schemaTypes})),this.props.editor||e.editor||(this.props.readOnly!==e.readOnly&&this.editor._internal.editorActor.send({type:"update readOnly",readOnly:this.props.readOnly??!1}),this.props.maxBlocks!==e.maxBlocks&&this.editor._internal.editorActor.send({type:"update maxBlocks",maxBlocks:void 0===this.props.maxBlocks?void 0:Number.parseInt(this.props.maxBlocks.toString(),10)}),this.props.value!==e.value&&this.editor._internal.editorActor.send({type:"update value",value:this.props.value}),this.props.editorRef!==e.editorRef&&this.props.editorRef&&(this.props.editorRef.current=this))}setEditable=e=>{this.editor._internal.editable={...this.editor._internal.editable,...e}};render(){let e=this.props.editor?void 0:this.props.incomingPatches$??this.props.patches$;return(0,a.jsxs)(a.Fragment,{children:[e?(0,a.jsx)(nm,{editorActor:this.editor._internal.editorActor,patches$:e}):null,(0,a.jsx)(nk,{editorActor:this.editor._internal.editorActor,onChange:e=>{this.props.editor||this.props.onChange(e),this.change$.next(e)}}),(0,a.jsx)(tm,{editorActor:this.editor._internal.editorActor,slateEditor:this.editor._internal.slateEditor.instance}),(0,a.jsx)(nd.Provider,{value:this.editor._internal.editorActor,children:(0,a.jsx)(s.A,{editor:this.editor._internal.slateEditor.instance,initialValue:this.editor._internal.slateEditor.initialValue,children:(0,a.jsx)(ei.Provider,{value:this,children:(0,a.jsx)(nf,{editorActor:this.editor._internal.editorActor,children:this.props.children})})})})]})}static activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[];static isAnnotationActive=(e,t)=>!!e&&!!e.editable&&e.editable.isAnnotationActive(t);static addAnnotation=(e,t,n)=>e.editable?.addAnnotation(t,n);static blur=e=>{ny("Host blurred"),e.editable?.blur()};static delete=(e,t,n)=>e.editable?.delete(t,n);static findDOMNode=(e,t)=>e.editable?.findDOMNode(t);static findByPath=(e,t)=>e.editable?.findByPath(t)||[];static focus=e=>{ny("Host requesting focus"),e.editable?.focus()};static focusBlock=e=>e.editable?.focusBlock();static focusChild=e=>e.editable?.focusChild();static getSelection=e=>e.editable?e.editable.getSelection():null;static getValue=e=>e.editable?.getValue();static hasBlockStyle=(e,t)=>e.editable?.hasBlockStyle(t);static hasListStyle=(e,t)=>e.editable?.hasListStyle(t);static isCollapsedSelection=e=>e.editable?.isCollapsedSelection();static isExpandedSelection=e=>e.editable?.isExpandedSelection();static isMarkActive=(e,t)=>e.editable?.isMarkActive(t);static insertChild=(e,t,n)=>(ny("Host inserting child"),e.editable?.insertChild(t,n));static insertBlock=(e,t,n)=>e.editable?.insertBlock(t,n);static insertBreak=e=>e.editable?.insertBreak();static isVoid=(e,t)=>e.editable?.isVoid(t);static isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1];return t.length>1&&"children"!==t[1]||n};static marks=e=>e.editable?.marks();static select=(e,t)=>{ny("Host setting selection",t),e.editable?.select(t)};static removeAnnotation=(e,t)=>e.editable?.removeAnnotation(t);static toggleBlockStyle=(e,t)=>(ny("Host is toggling block style"),e.editable?.toggleBlockStyle(t));static toggleList=(e,t)=>e.editable?.toggleList(t);static toggleMark=(e,t)=>{ny("Host toggling mark",t),e.editable?.toggleMark(t)};static getFragment=e=>e.editable?.getFragment();static undo=e=>{ny("Host undoing"),e.editable?.undo()};static redo=e=>{ny("Host redoing"),e.editable?.redo()};static isSelectionsOverlapping=(e,t,n)=>e.editable?.isSelectionsOverlapping(t,n)}function nm(e){let t,n;let o=(0,i.c)(4);return o[0]!==e.editorActor||o[1]!==e.patches$?(t=()=>{let t=e.patches$.subscribe(t=>{e.editorActor.send({type:"patches",...t})});return()=>{t.unsubscribe()}},n=[e.editorActor,e.patches$],o[0]=e.editorActor,o[1]=e.patches$,o[2]=t,o[3]=n):(t=o[2],n=o[3]),(0,r.useEffect)(t,n),null}function nk(e){let t,n,a;let s=(0,i.c)(7);s[0]!==e?(t=t=>e.onChange(t),s[0]=e,s[1]=t):t=s[1];let l=(0,o.J)(t);return s[2]!==l||s[3]!==e.editorActor?(n=()=>{ny("Subscribing to editor changes");let t=e.editorActor.on("*",e=>{switch(e.type){case"blurred":l({type:"blur",event:e.event});break;case"patch":case"mutation":case"ready":case"selection":case"unset":l(e);break;case"loading":l({type:"loading",isLoading:!0});break;case"done loading":l({type:"loading",isLoading:!1});break;case"focused":l({type:"focus",event:e.event});break;case"value changed":l({type:"value",value:e.value});break;case"invalid value":l({type:"invalidValue",resolution:e.resolution,value:e.value});break;case"error":l({...e,level:"warning"})}});return()=>{ny("Unsubscribing to changes"),t.unsubscribe()}},s[2]=l,s[3]=e.editorActor,s[4]=n):n=s[4],s[5]!==e.editorActor?(a=[e.editorActor],s[5]=e.editorActor,s[6]=a):a=s[6],(0,r.useEffect)(n,a),null}let nb=r.createContext(void 0);function nv(e){let t,n,r,o,c,d,h,p,u,f;let y=(0,i.c)(28),g=function(e){let t,n,r;let o=(0,i.c)(6);o[0]!==e?(t=nl(e),o[0]=e,o[1]=t):t=o[1],o[2]!==t?(n={input:t},o[2]=t,o[3]=n):n=o[3];let a=(0,l.qf)(ns,n);return o[4]!==a?(r=nc(a),o[4]=a,o[5]=r):r=o[5],r}(e.initialConfig),m=g._internal.editorActor,k=g._internal.slateEditor;return y[0]!==g?(n=new ng({editor:g}),y[0]=g,y[1]=n):n=y[1],t=n,y[2]!==t.change$?(r=e=>{t.change$.next(e)},y[2]=t.change$,y[3]=r):r=y[3],y[4]!==m||y[5]!==r?(o=(0,a.jsx)(nk,{editorActor:m,onChange:r}),y[4]=m,y[5]=r,y[6]=o):o=y[6],y[7]!==m||y[8]!==k.instance?(c=(0,a.jsx)(tm,{editorActor:m,slateEditor:k.instance}),y[7]=m,y[8]=k.instance,y[9]=c):c=y[9],y[10]!==m||y[11]!==e.children?(d=(0,a.jsx)(nf,{editorActor:m,children:e.children}),y[10]=m,y[11]=e.children,y[12]=d):d=y[12],y[13]!==t||y[14]!==d?(h=(0,a.jsx)(ei.Provider,{value:t,children:d}),y[13]=t,y[14]=d,y[15]=h):h=y[15],y[16]!==k.initialValue||y[17]!==k.instance||y[18]!==h?(p=(0,a.jsx)(s.A,{editor:k.instance,initialValue:k.initialValue,children:h}),y[16]=k.initialValue,y[17]=k.instance,y[18]=h,y[19]=p):p=y[19],y[20]!==m||y[21]!==p?(u=(0,a.jsx)(nd.Provider,{value:m,children:p}),y[20]=m,y[21]=p,y[22]=u):u=y[22],y[23]!==g||y[24]!==o||y[25]!==c||y[26]!==u?(f=(0,a.jsxs)(nb.Provider,{value:g,children:[o,c,u]}),y[23]=g,y[24]=o,y[25]=c,y[26]=u,y[27]=f):f=y[27],f}function nx(){let e=r.useContext(nb);if(!e)throw Error("No Editor set. Use EditorProvider to set one.");return e}function n_(e){let t,n;let a=(0,i.c)(5),s=nx(),l=(0,o.J)(e.on);return a[0]!==s||a[1]!==l?(t=()=>{let e=s.on("*",l);return()=>{e.unsubscribe()}},a[0]=s,a[1]=l,a[2]=t):t=a[2],a[3]!==s?(n=[s],a[3]=s,a[4]=n):n=a[4],(0,r.useEffect)(t,n),null}}}]);